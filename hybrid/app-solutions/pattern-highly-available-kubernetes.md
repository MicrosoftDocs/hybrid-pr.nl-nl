---
title: Kubernetes-patroon met hoge Beschik baarheid met behulp van Azure en Azure Stack hub
description: Meer informatie over hoe een Kubernetes-cluster oplossing hoge Beschik baarheid biedt met behulp van Azure en Azure Stack hub.
author: BryanLa
ms.topic: article
ms.date: 12/03/2020
ms.author: bryanla
ms.reviewer: bryanla
ms.lastreviewed: 12/03/2020
ms.openlocfilehash: 454cc0a0531882b7a8ec050a461420ce13eebcfe
ms.sourcegitcommit: df7e3e6423c3d4e8a42dae3d1acfba1d55057258
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 12/09/2020
ms.locfileid: "96911791"
---
# <a name="high-availability-kubernetes-cluster-pattern"></a><span data-ttu-id="a559b-103">Kubernetes-cluster patroon met hoge Beschik baarheid</span><span class="sxs-lookup"><span data-stu-id="a559b-103">High availability Kubernetes cluster pattern</span></span>

<span data-ttu-id="a559b-104">In dit artikel wordt beschreven hoe u een Maxi maal beschik bare Kubernetes-infra structuur met behulp van de Azure Kubernetes service (AKS)-engine op Azure Stack hub architectt en gebruikt.</span><span class="sxs-lookup"><span data-stu-id="a559b-104">This article describes how to architect and operate a highly available Kubernetes-based infrastructure using Azure Kubernetes Service (AKS) Engine on Azure Stack Hub.</span></span> <span data-ttu-id="a559b-105">Dit scenario is gebruikelijk voor organisaties met kritieke werk belastingen in zeer beperkte en gereglementeerde omgevingen.</span><span class="sxs-lookup"><span data-stu-id="a559b-105">This scenario is common for organizations with critical workloads in highly restricted and regulated environments.</span></span> <span data-ttu-id="a559b-106">Organisaties in domeinen zoals financiën, verdediging en overheid.</span><span class="sxs-lookup"><span data-stu-id="a559b-106">Organizations in domains such as finance, defense, and government.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="a559b-107">Context en probleem</span><span class="sxs-lookup"><span data-stu-id="a559b-107">Context and problem</span></span>

<span data-ttu-id="a559b-108">Veel organisaties ontwikkelen Cloud-systeem eigen oplossingen die gebruikmaken van geavanceerde services en technologieën, zoals Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="a559b-108">Many organizations are developing cloud-native solutions that leverage state-of-the-art services and technologies like Kubernetes.</span></span> <span data-ttu-id="a559b-109">Azure biedt data centers in de meeste regio's van de wereld, soms is er sprake van Edge use-cases en scenario's waarin bedrijfs kritieke toepassingen op een specifieke locatie moeten worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="a559b-109">Although Azure provides datacenters in most regions of the world, sometimes there are edge use-cases and scenarios where business critical applications must run in a specific location.</span></span> <span data-ttu-id="a559b-110">Overwegingen zijn onder andere:</span><span class="sxs-lookup"><span data-stu-id="a559b-110">Considerations include:</span></span>

- <span data-ttu-id="a559b-111">Locatie gevoeligheid</span><span class="sxs-lookup"><span data-stu-id="a559b-111">Location sensitivity</span></span>
- <span data-ttu-id="a559b-112">Latentie tussen de toepassing en on-premises systemen</span><span class="sxs-lookup"><span data-stu-id="a559b-112">Latency between the application and on-premises systems</span></span>
- <span data-ttu-id="a559b-113">Bandbreedte behoud</span><span class="sxs-lookup"><span data-stu-id="a559b-113">Bandwidth conservation</span></span>
- <span data-ttu-id="a559b-114">Connectiviteit</span><span class="sxs-lookup"><span data-stu-id="a559b-114">Connectivity</span></span>
- <span data-ttu-id="a559b-115">Wettelijke of wettelijke vereisten</span><span class="sxs-lookup"><span data-stu-id="a559b-115">Regulatory or statutory requirements</span></span>

<span data-ttu-id="a559b-116">Azure, in combi natie met Azure Stack hub, behandelt de meeste van deze problemen.</span><span class="sxs-lookup"><span data-stu-id="a559b-116">Azure, in combination with Azure Stack Hub, addresses most of these concerns.</span></span> <span data-ttu-id="a559b-117">Hieronder wordt een groot aantal opties, beslissingen en overwegingen gegeven voor een succes volle implementatie van Kubernetes die wordt uitgevoerd op Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-117">A broad set of options, decisions, and considerations for a successful implementation of Kubernetes running on Azure Stack Hub is described below.</span></span>

## <a name="solution"></a><span data-ttu-id="a559b-118">Oplossing</span><span class="sxs-lookup"><span data-stu-id="a559b-118">Solution</span></span>

<span data-ttu-id="a559b-119">In dit voor beeld wordt ervan uitgegaan dat we een strikte set beperkingen moeten afhandelen.</span><span class="sxs-lookup"><span data-stu-id="a559b-119">This pattern assumes that we have to deal with a strict set of constraints.</span></span> <span data-ttu-id="a559b-120">De toepassing moet on-premises worden uitgevoerd en alle persoonlijke gegevens mogen geen open bare Cloud Services bereiken.</span><span class="sxs-lookup"><span data-stu-id="a559b-120">The application must run on-premises and all personal data must not reach public cloud services.</span></span> <span data-ttu-id="a559b-121">Bewaking en andere niet-PII-gegevens kunnen naar Azure worden verzonden en daar worden verwerkt.</span><span class="sxs-lookup"><span data-stu-id="a559b-121">Monitoring and other non-PII data can be sent to Azure and be processed there.</span></span> <span data-ttu-id="a559b-122">Externe services, zoals een openbaar Container Registry of anderen, kunnen worden geopend, maar kunnen worden gefilterd via een firewall of proxy server.</span><span class="sxs-lookup"><span data-stu-id="a559b-122">External services like a public Container Registry or others can be accessed but might be filtered through a firewall or proxy server.</span></span>

<span data-ttu-id="a559b-123">De voorbeeld toepassing die hier wordt weer gegeven (gebaseerd op [Azure Kubernetes service workshop](/learn/modules/aks-workshop/)) is ontworpen voor gebruik waar mogelijk Kubernetes-systeem eigen oplossingen.</span><span class="sxs-lookup"><span data-stu-id="a559b-123">The sample application shown here (based on [Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) is designed to use Kubernetes-native solutions whenever possible.</span></span> <span data-ttu-id="a559b-124">Met dit ontwerp voor komt u dat de leverancier wordt vergrendeld, in plaats van platform-systeem eigen services te gebruiken.</span><span class="sxs-lookup"><span data-stu-id="a559b-124">This design avoids vendor lock-in, instead of using platform-native services.</span></span> <span data-ttu-id="a559b-125">Als voor beeld gebruikt de toepassing een zelf-hostende MongoDB data base-back-end in plaats van een PaaS-service of externe database service.</span><span class="sxs-lookup"><span data-stu-id="a559b-125">As an example, the application uses a self-hosted MongoDB database backend instead of a PaaS service or external database service.</span></span>

<span data-ttu-id="a559b-126">[![Toepassings patroon hybride](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="a559b-126">[![Application Pattern Hybrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span></span>

<span data-ttu-id="a559b-127">In het voor gaande diagram ziet u de toepassings architectuur van de voorbeeld toepassing die wordt uitgevoerd op Kubernetes op Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-127">The preceding diagram illustrates the application architecture of the sample application running on Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="a559b-128">De app bestaat uit verschillende onderdelen, waaronder:</span><span class="sxs-lookup"><span data-stu-id="a559b-128">The app consists of several components, including:</span></span>

 1) <span data-ttu-id="a559b-129">Een op AKS engine gebaseerd Kubernetes-cluster op Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-129">An AKS Engine based Kubernetes cluster on Azure Stack Hub.</span></span>
 2) <span data-ttu-id="a559b-130">[CERT-Manager](https://www.jetstack.io/cert-manager/), waarmee een reeks hulpprogram ma's voor certificaat beheer wordt geboden in Kubernetes, die wordt gebruikt om automatisch certificaten aan te vragen van de code ring.</span><span class="sxs-lookup"><span data-stu-id="a559b-130">[cert-manager](https://www.jetstack.io/cert-manager/), which provides a suite of tools for certificate management in Kubernetes, used to automatically request certificates from Let's Encrypt.</span></span>
 3) <span data-ttu-id="a559b-131">Een Kubernetes-naam ruimte die de toepassings onderdelen bevat voor de front-end (beoordelingen-web), API (classificaties-API) en data base (ratings-MongoDb).</span><span class="sxs-lookup"><span data-stu-id="a559b-131">A Kubernetes namespace that contains the application components for the front end (ratings-web), api (ratings-api), and database (ratings-mongodb).</span></span>
 4) <span data-ttu-id="a559b-132">De ingangs controller die HTTP/HTTPS-verkeer naar eind punten in het Kubernetes-cluster routeert.</span><span class="sxs-lookup"><span data-stu-id="a559b-132">The Ingress Controller that routes HTTP/HTTPS traffic to endpoints within the Kubernetes cluster.</span></span>

<span data-ttu-id="a559b-133">De voorbeeld toepassing wordt gebruikt om de toepassings architectuur te illustreren.</span><span class="sxs-lookup"><span data-stu-id="a559b-133">The sample application is used to illustrate the application architecture.</span></span> <span data-ttu-id="a559b-134">Alle onderdelen zijn voor beelden.</span><span class="sxs-lookup"><span data-stu-id="a559b-134">All components are examples.</span></span> <span data-ttu-id="a559b-135">De architectuur bevat slechts één implementatie van een toepassing.</span><span class="sxs-lookup"><span data-stu-id="a559b-135">The architecture contains only a single application deployment.</span></span> <span data-ttu-id="a559b-136">Om hoge Beschik baarheid (HA) te kunnen uitvoeren, worden de implementatie ten minste twee keer op twee verschillende Azure Stack hub-instanties uitgevoerd. ze kunnen worden uitgevoerd op dezelfde locatie of op twee (of meer) verschillende sites:</span><span class="sxs-lookup"><span data-stu-id="a559b-136">To achieve high availability (HA), we'll run the deployment at least twice on two different Azure Stack Hub instances - they can run either in the same location or in two (or more) different sites:</span></span>

![Infrastructuur architectuur](media/pattern-highly-available-kubernetes/aks-azure-architecture.png)

<span data-ttu-id="a559b-138">Services als Azure Container Registry, Azure Monitor en anderen, worden buiten Azure Stack hub gehost in azure of on-premises.</span><span class="sxs-lookup"><span data-stu-id="a559b-138">Services like Azure Container Registry, Azure Monitor, and others, are hosted outside Azure Stack Hub in Azure or on-premises.</span></span> <span data-ttu-id="a559b-139">Dit hybride ontwerp beveiligt de oplossing tegen storingen van één Azure Stack hub-exemplaar.</span><span class="sxs-lookup"><span data-stu-id="a559b-139">This hybrid design protects the solution against outage of a single Azure Stack Hub instance.</span></span>

## <a name="components"></a><span data-ttu-id="a559b-140">Onderdelen</span><span class="sxs-lookup"><span data-stu-id="a559b-140">Components</span></span>

<span data-ttu-id="a559b-141">De algemene architectuur bestaat uit de volgende onderdelen:</span><span class="sxs-lookup"><span data-stu-id="a559b-141">The overall architecture consists of the following components:</span></span>

<span data-ttu-id="a559b-142">**Azure stack hub** is een uitbrei ding van Azure waarmee werk belastingen kunnen worden uitgevoerd in een on-premises omgeving door Azure-Services in uw Data Center te bieden.</span><span class="sxs-lookup"><span data-stu-id="a559b-142">**Azure Stack Hub** is an extension of Azure that can run workloads in an on-premises environment by providing Azure services in your datacenter.</span></span> <span data-ttu-id="a559b-143">Ga naar [Azure stack hub-overzicht](/azure-stack/operator/azure-stack-overview) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-143">Go to [Azure Stack Hub overview](/azure-stack/operator/azure-stack-overview) to learn more.</span></span>

<span data-ttu-id="a559b-144">De **Azure Kubernetes service Engine (AKS-Engine)** is de engine achter de beheerde Kubernetes service-aanbieding, Azure Kubernetes service (AKS), die momenteel beschikbaar is in Azure.</span><span class="sxs-lookup"><span data-stu-id="a559b-144">**Azure Kubernetes Service Engine (AKS Engine)** is the engine behind the managed Kubernetes service offering, Azure Kubernetes Service (AKS), that is available in Azure today.</span></span> <span data-ttu-id="a559b-145">Met de AKS-engine van Azure Stack hub kunt u volledig functionele, zelf-beheerde Kubernetes-clusters implementeren, schalen en upgraden met behulp van de IaaS-mogelijkheden van Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-145">For Azure Stack Hub, AKS Engine allows us to deploy, scale, and upgrade fully featured, self-managed Kubernetes clusters using Azure Stack Hub's IaaS capabilities.</span></span> <span data-ttu-id="a559b-146">Ga naar [overzicht](https://github.com/Azure/aks-engine) van de AKS-engine voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-146">Go to [AKS Engine Overview](https://github.com/Azure/aks-engine) to learn more.</span></span>

<span data-ttu-id="a559b-147">Ga naar [bekende problemen en beperkingen](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) voor meer informatie over de verschillen tussen de AKS-engine op Azure en de AKS-engine op Azure stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-147">Go to [Known Issues and Limitations](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) to learn more about the differences between AKS Engine on Azure and AKS Engine on Azure Stack Hub.</span></span>

<span data-ttu-id="a559b-148">**Azure Virtual Network (VNet)** wordt gebruikt om de netwerk infrastructuur op elke Azure stack hub te bieden voor de virtual machines (vm's) die de Kubernetes-cluster infrastructuur hosten.</span><span class="sxs-lookup"><span data-stu-id="a559b-148">**Azure Virtual Network (VNet)** is used to provide the network infrastructure on each Azure Stack Hub for the Virtual Machines (VMs) hosting the Kubernetes cluster infrastructure.</span></span>

<span data-ttu-id="a559b-149">**Azure Load Balancer** wordt gebruikt voor het Kubernetes API-eind punt en de nginx ingangs controller.</span><span class="sxs-lookup"><span data-stu-id="a559b-149">**Azure Load Balancer** is used for the Kubernetes API Endpoint and the Nginx Ingress Controller.</span></span> <span data-ttu-id="a559b-150">De load balancer stuurt externe verkeer (bijvoorbeeld Internet) naar knoop punten en Vm's die een specifieke service bieden.</span><span class="sxs-lookup"><span data-stu-id="a559b-150">The load balancer routes external (for example, Internet) traffic to nodes and VMs offering a specific service.</span></span>

<span data-ttu-id="a559b-151">**Azure container Registry (ACR)** wordt gebruikt voor het opslaan van persoonlijke docker-installatie kopieën en helm-grafieken, die worden geïmplementeerd in het cluster.</span><span class="sxs-lookup"><span data-stu-id="a559b-151">**Azure Container Registry (ACR)** is used to store private Docker images and Helm charts, which are deployed to the cluster.</span></span> <span data-ttu-id="a559b-152">De AKS-engine kan worden geverifieerd met de Container Registry met behulp van een Azure AD-identiteit.</span><span class="sxs-lookup"><span data-stu-id="a559b-152">AKS Engine can authenticate with the Container Registry using an Azure AD identity.</span></span> <span data-ttu-id="a559b-153">Kubernetes vereist geen ACR.</span><span class="sxs-lookup"><span data-stu-id="a559b-153">Kubernetes doesn't require ACR.</span></span> <span data-ttu-id="a559b-154">U kunt andere container registers gebruiken, zoals docker hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-154">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="a559b-155">**Azure opslag plaatsen** is een set hulpprogram ma's voor versie beheer die u kunt gebruiken om uw code te beheren.</span><span class="sxs-lookup"><span data-stu-id="a559b-155">**Azure Repos** is a set of version control tools that you can use to manage your code.</span></span> <span data-ttu-id="a559b-156">U kunt ook GitHub of andere opslag plaatsen op basis van Git gebruiken.</span><span class="sxs-lookup"><span data-stu-id="a559b-156">You can also use GitHub or other git-based repositories.</span></span> <span data-ttu-id="a559b-157">Ga naar [Azure opslag plaatsen Overview](/azure/devops/repos/get-started/what-is-repos) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-157">Go to [Azure Repos Overview](/azure/devops/repos/get-started/what-is-repos) to learn more.</span></span>

<span data-ttu-id="a559b-158">**Azure-pipelines** maakt deel uit van Azure DevOps Services en voert automatische builds, tests en implementaties uit.</span><span class="sxs-lookup"><span data-stu-id="a559b-158">**Azure Pipelines** is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="a559b-159">U kunt ook gebruikmaken van CI/CD-oplossingen van derden, zoals Jenkins.</span><span class="sxs-lookup"><span data-stu-id="a559b-159">You can also use third-party CI/CD solutions such as Jenkins.</span></span> <span data-ttu-id="a559b-160">Ga naar [overzicht van Azure-pijp lijn](/azure/devops/pipelines/get-started/what-is-azure-pipelines) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-160">Go to [Azure Pipeline Overview](/azure/devops/pipelines/get-started/what-is-azure-pipelines) to learn more.</span></span>

<span data-ttu-id="a559b-161">**Azure monitor** worden metrische gegevens en logboeken verzameld en opgeslagen, met inbegrip van de metrische gegevens van het platform voor de Azure-Services in de oplossing en de telemetrie van de toepassing.</span><span class="sxs-lookup"><span data-stu-id="a559b-161">**Azure Monitor** collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="a559b-162">Gebruik deze gegevens om de toepassing te controleren, waarschuwingen en dash boards in te stellen en de belangrijkste oorzaak analyse van fouten uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="a559b-162">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="a559b-163">Azure Monitor integreert met Kubernetes voor het verzamelen van metrische gegevens van controllers, knoop punten en containers, evenals container logboeken en hoofd knooppunt Logboeken.</span><span class="sxs-lookup"><span data-stu-id="a559b-163">Azure Monitor integrates with Kubernetes to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span> <span data-ttu-id="a559b-164">Ga naar [Azure Monitor overzicht](/azure/azure-monitor/overview) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-164">Go to [Azure Monitor Overview](/azure/azure-monitor/overview) to learn more.</span></span>

<span data-ttu-id="a559b-165">**Azure Traffic Manager** is een op DNS gebaseerd verkeer Load Balancer waarmee u verkeer optimaal kunt distribueren naar Services in verschillende Azure-regio's of implementaties van Azure stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-165">**Azure Traffic Manager** is a DNS-based traffic load balancer that enables you to distribute traffic optimally to services across different Azure regions or Azure Stack Hub deployments.</span></span> <span data-ttu-id="a559b-166">Traffic Manager biedt ook hoge Beschik baarheid en reactie snelheid.</span><span class="sxs-lookup"><span data-stu-id="a559b-166">Traffic Manager also provides high availability and responsiveness.</span></span> <span data-ttu-id="a559b-167">De eind punten van de toepassing moeten toegankelijk zijn vanaf buiten.</span><span class="sxs-lookup"><span data-stu-id="a559b-167">The application endpoints must be accessible from the outside.</span></span> <span data-ttu-id="a559b-168">Er zijn ook andere on-premises oplossingen beschikbaar.</span><span class="sxs-lookup"><span data-stu-id="a559b-168">There are other on-premises solutions available as well.</span></span>

<span data-ttu-id="a559b-169">Met de **Kubernetes ingress-controller** worden http (S)-routes naar Services in een Kubernetes-cluster getoond.</span><span class="sxs-lookup"><span data-stu-id="a559b-169">**Kubernetes Ingress Controller** exposes HTTP(S) routes to services in a Kubernetes cluster.</span></span> <span data-ttu-id="a559b-170">Nginx of een wille keurige ingangs controller kan voor dit doel worden gebruikt.</span><span class="sxs-lookup"><span data-stu-id="a559b-170">Nginx or any suitable ingress controller can be used for this purpose.</span></span>

<span data-ttu-id="a559b-171">**Helm** is een pakket beheerder voor Kubernetes-implementatie, waarmee u verschillende Kubernetes-objecten zoals implementaties, services en geheimen kunt bundelen in één grafiek.</span><span class="sxs-lookup"><span data-stu-id="a559b-171">**Helm** is a package manager for Kubernetes deployment, providing a way to bundle different Kubernetes objects like Deployments, Services, Secrets, into a single "chart".</span></span> <span data-ttu-id="a559b-172">U kunt het publiceren, implementeren, beheren van versie beheer en het bijwerken van een grafiek object.</span><span class="sxs-lookup"><span data-stu-id="a559b-172">You can publish, deploy, control version management, and update a chart  object.</span></span> <span data-ttu-id="a559b-173">Azure Container Registry kunnen worden gebruikt als opslag plaats voor het opslaan van verpakte helm-grafieken.</span><span class="sxs-lookup"><span data-stu-id="a559b-173">Azure Container Registry can be used as a repository to store packaged Helm Charts.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="a559b-174">Overwegingen bij het ontwerpen</span><span class="sxs-lookup"><span data-stu-id="a559b-174">Design considerations</span></span>

<span data-ttu-id="a559b-175">In de volgende secties van dit artikel wordt dit patroon gevolgd door enkele belang rijke overwegingen voor het hoge niveau:</span><span class="sxs-lookup"><span data-stu-id="a559b-175">This pattern follows a few high-level considerations explained in more detail in the next sections of this article:</span></span>

- <span data-ttu-id="a559b-176">De toepassing maakt gebruik van Kubernetes-systeem eigen oplossingen om de vergren deling van een leverancier te voor komen.</span><span class="sxs-lookup"><span data-stu-id="a559b-176">The application uses Kubernetes-native solutions, to avoid vendor lock-in.</span></span>
- <span data-ttu-id="a559b-177">De toepassing maakt gebruik van een micro service architectuur.</span><span class="sxs-lookup"><span data-stu-id="a559b-177">The application uses a microservices architecture.</span></span>
- <span data-ttu-id="a559b-178">Azure Stack hub heeft geen inkomende toegang nodig, maar maakt een uitgaande Internet verbinding mogelijk.</span><span class="sxs-lookup"><span data-stu-id="a559b-178">Azure Stack Hub doesn't need inbound but allows outbound Internet connectivity.</span></span>

<span data-ttu-id="a559b-179">Deze aanbevolen procedures zijn ook van toepassing op Real-World-workloads en scenario's.</span><span class="sxs-lookup"><span data-stu-id="a559b-179">These recommended practices will apply to real-world workloads and scenarios as well.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="a559b-180">Schaalbaarheidsoverwegingen</span><span class="sxs-lookup"><span data-stu-id="a559b-180">Scalability considerations</span></span>

<span data-ttu-id="a559b-181">Schaal baarheid is belang rijk om gebruikers consistente, betrouw bare en goed presterende toegang te bieden tot de toepassing.</span><span class="sxs-lookup"><span data-stu-id="a559b-181">Scalability is important to provide users consistent, reliable, and well-performing access to the application.</span></span>

<span data-ttu-id="a559b-182">Het voorbeeld scenario heeft betrekking op schaal baarheid op meerdere lagen van de toepassings stack.</span><span class="sxs-lookup"><span data-stu-id="a559b-182">The sample scenario covers scalability on multiple layers of the application stack.</span></span> <span data-ttu-id="a559b-183">Dit is een overzicht op hoog niveau van de verschillende lagen:</span><span class="sxs-lookup"><span data-stu-id="a559b-183">Here's a high-level overview of the different layers:</span></span>

| <span data-ttu-id="a559b-184">Architectuur niveau</span><span class="sxs-lookup"><span data-stu-id="a559b-184">Architecture level</span></span> | <span data-ttu-id="a559b-185">Alleen</span><span class="sxs-lookup"><span data-stu-id="a559b-185">Affects</span></span> | <span data-ttu-id="a559b-186">Hoe?</span><span class="sxs-lookup"><span data-stu-id="a559b-186">How?</span></span> |
| --- | --- | ---
| <span data-ttu-id="a559b-187">Toepassing</span><span class="sxs-lookup"><span data-stu-id="a559b-187">Application</span></span> | <span data-ttu-id="a559b-188">Toepassing</span><span class="sxs-lookup"><span data-stu-id="a559b-188">Application</span></span> | <span data-ttu-id="a559b-189">Horizon taal schalen op basis van het aantal peulen/Replica's/Container Instances \*</span><span class="sxs-lookup"><span data-stu-id="a559b-189">Horizontal scaling based on the number of Pods/Replicas/Container Instances\*</span></span> |
| <span data-ttu-id="a559b-190">Cluster</span><span class="sxs-lookup"><span data-stu-id="a559b-190">Cluster</span></span> | <span data-ttu-id="a559b-191">Kubernetes-cluster</span><span class="sxs-lookup"><span data-stu-id="a559b-191">Kubernetes cluster</span></span> | <span data-ttu-id="a559b-192">Aantal knoop punten (tussen 1 en 50), VM-SKU-grootten en knooppunt Pools (AKS-engine op Azure Stack hub ondersteunt momenteel slechts één knooppunt groep); de schaal opdracht van de AKS-engine gebruiken (hand matig)</span><span class="sxs-lookup"><span data-stu-id="a559b-192">Number of Nodes (between 1 and 50), VM-SKU-sizes, and Node Pools (AKS Engine on Azure Stack Hub currently supports only a single node pool); using AKS Engine's scale command (manual)</span></span> |
| <span data-ttu-id="a559b-193">Infrastructuur</span><span class="sxs-lookup"><span data-stu-id="a559b-193">Infrastructure</span></span> | <span data-ttu-id="a559b-194">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="a559b-194">Azure Stack Hub</span></span> | <span data-ttu-id="a559b-195">Aantal knoop punten, capaciteit en schaal eenheden binnen een Azure Stack hub-implementatie</span><span class="sxs-lookup"><span data-stu-id="a559b-195">Number of nodes, capacity, and scale units within an Azure Stack Hub deployment</span></span> |

<span data-ttu-id="a559b-196">\* Kubernetes ' Horizontal pod autoscaleer (HPA) gebruiken; geautomatiseerd schalen op basis van metrische gegevens of verticaal schalen door het formaat van de container instanties te verg Roten (CPU/geheugen).</span><span class="sxs-lookup"><span data-stu-id="a559b-196">\* Using Kubernetes' Horizontal Pod Autoscaler (HPA); automated metric-based scaling or vertical scaling by sizing the container instances (cpu/memory).</span></span>

<span data-ttu-id="a559b-197">**Azure Stack hub (infrastructuur niveau)**</span><span class="sxs-lookup"><span data-stu-id="a559b-197">**Azure Stack Hub (infrastructure level)**</span></span>

<span data-ttu-id="a559b-198">De infra structuur van Azure Stack hub is de basis van deze implementatie, omdat Azure Stack hub op fysieke hardware in een Data Center wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="a559b-198">The Azure Stack Hub infrastructure is the foundation of this implementation, because Azure Stack Hub runs on physical hardware in a datacenter.</span></span> <span data-ttu-id="a559b-199">Wanneer u uw hub-hardware selecteert, moet u keuzen maken voor CPU, geheugen densiteit, opslag configuratie en aantal servers.</span><span class="sxs-lookup"><span data-stu-id="a559b-199">When selecting your Hub hardware, you need to make choices for CPU, memory density, storage configuration, and number of servers.</span></span> <span data-ttu-id="a559b-200">Raadpleeg de volgende bronnen voor meer informatie over de schaal baarheid van Azure Stack hub:</span><span class="sxs-lookup"><span data-stu-id="a559b-200">To learn more about Azure Stack Hub's scalability, check out the following resources:</span></span>

- [<span data-ttu-id="a559b-201">Overzicht van capaciteits planning voor Azure Stack hub</span><span class="sxs-lookup"><span data-stu-id="a559b-201">Capacity planning for Azure Stack Hub overview</span></span>](/azure-stack/operator/azure-stack-capacity-planning-overview)
- [<span data-ttu-id="a559b-202">Extra knoop punten voor schaal eenheden toevoegen in Azure Stack hub</span><span class="sxs-lookup"><span data-stu-id="a559b-202">Add additional scale unit nodes in Azure Stack Hub</span></span>](/azure-stack/operator/azure-stack-add-scale-node)

<span data-ttu-id="a559b-203">**Kubernetes-cluster (cluster niveau)**</span><span class="sxs-lookup"><span data-stu-id="a559b-203">**Kubernetes cluster (cluster level)**</span></span>

<span data-ttu-id="a559b-204">Het Kubernetes-cluster zelf bestaat uit en is gebaseerd op Azure (stack) IaaS-onderdelen, waaronder reken-, opslag-en netwerk bronnen.</span><span class="sxs-lookup"><span data-stu-id="a559b-204">The Kubernetes cluster itself consists of, and is built on top of Azure (Stack) IaaS components including compute, storage, and network resources.</span></span> <span data-ttu-id="a559b-205">Kubernetes-oplossingen hebben betrekking op Master-en worker-knoop punten, die worden geïmplementeerd als Vm's in azure (en Azure Stack hub).</span><span class="sxs-lookup"><span data-stu-id="a559b-205">Kubernetes solutions involve master and worker nodes, which are deployed as VMs in Azure (and Azure Stack Hub).</span></span>

- <span data-ttu-id="a559b-206">[Control vlak nodes](/azure/aks/concepts-clusters-workloads#control-plane) (Master) bieden de kern Kubernetes Services en de indeling van werk belastingen van toepassingen.</span><span class="sxs-lookup"><span data-stu-id="a559b-206">[Control plane nodes](/azure/aks/concepts-clusters-workloads#control-plane) (master) provide the core Kubernetes services and orchestration of application workloads.</span></span>
- <span data-ttu-id="a559b-207">[Werk knooppunten](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (werk nemers) voeren de werk belastingen van uw toepassingen uit.</span><span class="sxs-lookup"><span data-stu-id="a559b-207">[Worker nodes](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (worker) run your application workloads.</span></span>

<span data-ttu-id="a559b-208">Wanneer u VM-grootten voor de eerste implementatie selecteert, zijn er verschillende overwegingen:</span><span class="sxs-lookup"><span data-stu-id="a559b-208">When selecting VM sizes for the initial deployment, there are several considerations:</span></span>  

- <span data-ttu-id="a559b-209">**Kosten** : bij het plannen van uw worker-knoop punten houdt u rekening met de totale kosten per VM.</span><span class="sxs-lookup"><span data-stu-id="a559b-209">**Cost** - When planning your worker nodes, keep in mind the overall cost per VM you'll incur.</span></span> <span data-ttu-id="a559b-210">Als de werk belasting van uw toepassing bijvoorbeeld beperkte bronnen vereist, moet u plannen om kleinere virtuele machines te implementeren.</span><span class="sxs-lookup"><span data-stu-id="a559b-210">For example, if your application workloads require limited resources, you should plan to deploy smaller sized VMs.</span></span> <span data-ttu-id="a559b-211">Azure Stack hub, zoals Azure, wordt normaal gesp roken gefactureerd op basis van verbruik. Daarom is het van groot belang dat de virtuele machines voor Kubernetes-rollen cruciaal zijn voor het optimaliseren van verbruiks kosten.</span><span class="sxs-lookup"><span data-stu-id="a559b-211">Azure Stack Hub, like Azure, is normally billed on a consumption basis, so appropriately sizing the VMs for Kubernetes roles is crucial to optimizing consumption costs.</span></span> 

- <span data-ttu-id="a559b-212">**Schaal baarheid: schaal** baarheid van het cluster wordt bereikt door het aantal hoofd-en werk knooppunten te schalen of door extra knooppunt groepen toe te voegen (die momenteel niet beschikbaar zijn op Azure stack hub).</span><span class="sxs-lookup"><span data-stu-id="a559b-212">**Scalability** - Scalability of the cluster is achieved by scaling in and out the number of master and worker nodes, or by adding additional node pools (not available on Azure Stack Hub today).</span></span> <span data-ttu-id="a559b-213">Het schalen van het cluster kan worden uitgevoerd op basis van prestatie gegevens die zijn verzameld met behulp van container Insights (Azure Monitor + Log Analytics).</span><span class="sxs-lookup"><span data-stu-id="a559b-213">Scaling the cluster can be done based on performance data, collected using Container Insights (Azure Monitor + Log Analytics).</span></span> 

    <span data-ttu-id="a559b-214">Als uw toepassing meer (of minder) resources nodig heeft, kunt u de huidige knoop punten horizon taal (of in) schalen (tussen 1 en 50 knoop punten).</span><span class="sxs-lookup"><span data-stu-id="a559b-214">If your application needs more (or fewer) resources, you can scale out (or in) your current nodes horizontally (between 1 and 50 nodes).</span></span> <span data-ttu-id="a559b-215">Als u meer dan 50 knoop punten nodig hebt, kunt u een extra cluster maken in een afzonderlijk abonnement.</span><span class="sxs-lookup"><span data-stu-id="a559b-215">If you need more than 50 nodes, you can create an additional cluster in a separate subscription.</span></span> <span data-ttu-id="a559b-216">U kunt de werkelijke Vm's niet verticaal schalen naar een andere VM-grootte zonder het cluster opnieuw te implementeren.</span><span class="sxs-lookup"><span data-stu-id="a559b-216">You can't scale up the actual VMs vertically to another VM size without redeploying the cluster.</span></span>

    <span data-ttu-id="a559b-217">U kunt de schaal hand matig schalen met behulp van de AKS engine helper-VM die in eerste instantie is gebruikt voor het implementeren van het Kubernetes-cluster.</span><span class="sxs-lookup"><span data-stu-id="a559b-217">Scaling is done manually using the AKS Engine helper VM that was used to deploy the Kubernetes cluster initially.</span></span> <span data-ttu-id="a559b-218">Zie [Kubernetes-clusters schalen](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md) voor meer informatie</span><span class="sxs-lookup"><span data-stu-id="a559b-218">For more information, see [Scaling Kubernetes clusters](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span></span>

- <span data-ttu-id="a559b-219">**Quota's** : Houd rekening met de [quota's](/azure-stack/operator/azure-stack-quota-types) die u hebt geconfigureerd bij het plannen van een AKS-implementatie op uw Azure stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-219">**Quotas** - Consider the [quotas](/azure-stack/operator/azure-stack-quota-types) you've configured when planning out an AKS deployment on your Azure Stack Hub.</span></span> <span data-ttu-id="a559b-220">Zorg ervoor dat voor elk [abonnement](/azure-stack/operator/service-plan-offer-subscription-overview) de juiste plannen en de quota's zijn geconfigureerd.</span><span class="sxs-lookup"><span data-stu-id="a559b-220">Make sure each [subscription](/azure-stack/operator/service-plan-offer-subscription-overview) has the proper plans and the quotas configured.</span></span> <span data-ttu-id="a559b-221">Het abonnement moet voldoen aan de berekenings-, opslag-en andere services die nodig zijn voor uw clusters wanneer deze worden uitgeschaald.</span><span class="sxs-lookup"><span data-stu-id="a559b-221">The subscription will need to accommodate the amount of compute, storage, and other services needed for your clusters as they scale out.</span></span>

- <span data-ttu-id="a559b-222">**Werk belastingen voor toepassingen** : Raadpleeg de [concepten voor clusters en workloads](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) in het Kubernetes core-concepten voor Azure Kubernetes service-document.</span><span class="sxs-lookup"><span data-stu-id="a559b-222">**Application workloads** - Refer to the [Clusters and workloads concepts](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) in the Kubernetes core concepts for Azure Kubernetes Service document.</span></span> <span data-ttu-id="a559b-223">Dit artikel helpt u bij het bereiken van de juiste VM-grootte op basis van de berekenings-en geheugen behoeften van uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="a559b-223">This article will help you scope the proper VM size based on the compute and memory needs of your application.</span></span>  

<span data-ttu-id="a559b-224">**Toepassing (toepassings niveau)**</span><span class="sxs-lookup"><span data-stu-id="a559b-224">**Application (application level)**</span></span>

<span data-ttu-id="a559b-225">Op de toepassingslaag gebruiken we Kubernetes [horizontal pod autoscaleer (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span><span class="sxs-lookup"><span data-stu-id="a559b-225">On the application layer, we use Kubernetes [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span></span> <span data-ttu-id="a559b-226">HPA kan het aantal Replica's (pod/Container Instances) in onze implementatie verhogen of verlagen op basis van verschillende metrische gegevens (zoals CPU-gebruik).</span><span class="sxs-lookup"><span data-stu-id="a559b-226">HPA can increase or decrease the number of Replicas (Pod/Container Instances) in our deployment based on different metrics (like CPU utilization).</span></span>

<span data-ttu-id="a559b-227">Een andere optie is om container instanties verticaal te schalen.</span><span class="sxs-lookup"><span data-stu-id="a559b-227">Another option is to scale container instances vertically.</span></span> <span data-ttu-id="a559b-228">Dit kan worden bereikt door de hoeveelheid CPU en geheugen die is aangevraagd en beschikbaar te wijzigen voor een specifieke implementatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-228">This can be accomplished by changing the amount of CPU and Memory requested and available for a specific deployment.</span></span> <span data-ttu-id="a559b-229">Zie [resources beheren voor containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) op kubernetes.io voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-229">See [Managing Resources for Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) on kubernetes.io to learn more.</span></span>

## <a name="networking-and-connectivity-considerations"></a><span data-ttu-id="a559b-230">Overwegingen voor netwerk-en connectiviteit</span><span class="sxs-lookup"><span data-stu-id="a559b-230">Networking and connectivity considerations</span></span>

<span data-ttu-id="a559b-231">Netwerken en connectiviteit zijn ook van invloed op de drie lagen die eerder zijn vermeld voor Kubernetes op Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-231">Networking and connectivity also affect the three layers mentioned previously for Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="a559b-232">De volgende tabel bevat de lagen en de services die ze bevatten:</span><span class="sxs-lookup"><span data-stu-id="a559b-232">The following table shows the layers and which services they contain:</span></span>

| <span data-ttu-id="a559b-233">Laag</span><span class="sxs-lookup"><span data-stu-id="a559b-233">Layer</span></span> | <span data-ttu-id="a559b-234">Alleen</span><span class="sxs-lookup"><span data-stu-id="a559b-234">Affects</span></span> | <span data-ttu-id="a559b-235">Wat?</span><span class="sxs-lookup"><span data-stu-id="a559b-235">What?</span></span> |
| --- | --- | ---
| <span data-ttu-id="a559b-236">Toepassing</span><span class="sxs-lookup"><span data-stu-id="a559b-236">Application</span></span> | <span data-ttu-id="a559b-237">Toepassing</span><span class="sxs-lookup"><span data-stu-id="a559b-237">Application</span></span> | <span data-ttu-id="a559b-238">Hoe is de toepassing toegankelijk?</span><span class="sxs-lookup"><span data-stu-id="a559b-238">How is the application accessible?</span></span> <span data-ttu-id="a559b-239">Wordt het blootgesteld aan Internet?</span><span class="sxs-lookup"><span data-stu-id="a559b-239">Will it be exposed to the Internet?</span></span> |
| <span data-ttu-id="a559b-240">Cluster</span><span class="sxs-lookup"><span data-stu-id="a559b-240">Cluster</span></span> | <span data-ttu-id="a559b-241">Kubernetes-cluster</span><span class="sxs-lookup"><span data-stu-id="a559b-241">Kubernetes cluster</span></span> | <span data-ttu-id="a559b-242">Kubernetes-API, AKS engine-VM, container installatie kopieën ophalen (uitgaand), controle gegevens en telemetrie verzenden (uitgaand)</span><span class="sxs-lookup"><span data-stu-id="a559b-242">Kubernetes API, AKS Engine VM, Pulling container images (egress), Sending monitoring data and telemetry (egress)</span></span> |
| <span data-ttu-id="a559b-243">Infrastructuur</span><span class="sxs-lookup"><span data-stu-id="a559b-243">Infrastructure</span></span> | <span data-ttu-id="a559b-244">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="a559b-244">Azure Stack Hub</span></span> | <span data-ttu-id="a559b-245">Toegankelijkheid van de Azure Stack hub-beheer eindpunten, zoals de portal en Azure Resource Manager-eind punten.</span><span class="sxs-lookup"><span data-stu-id="a559b-245">Accessibility of the Azure Stack Hub management endpoints like the portal and Azure Resource Manager endpoints.</span></span> |

<span data-ttu-id="a559b-246">**Toepassing**</span><span class="sxs-lookup"><span data-stu-id="a559b-246">**Application**</span></span>

<span data-ttu-id="a559b-247">Voor de toepassingslaag is het belang rijk om te bepalen of de toepassing beschikbaar is en toegankelijk is via internet.</span><span class="sxs-lookup"><span data-stu-id="a559b-247">For the application layer, the most important consideration is whether the application is exposed and accessible from the Internet.</span></span> <span data-ttu-id="a559b-248">Vanuit een Kubernetes-perspectief houdt Internet toegankelijkheid bij het weer geven van een implementatie of pod met behulp van een Kubernetes-service of een ingangs controller.</span><span class="sxs-lookup"><span data-stu-id="a559b-248">From a Kubernetes perspective, Internet accessibility means exposing a deployment or pod using a Kubernetes Service or an Ingress Controller.</span></span>

> [!NOTE]
> <span data-ttu-id="a559b-249">Het is raadzaam om inkomende controllers te gebruiken om Kubernetes services beschikbaar te maken, omdat het aantal open bare frontend-Ip's op Azure Stack hub beperkt is tot 5.</span><span class="sxs-lookup"><span data-stu-id="a559b-249">We recommend the use of Ingress controllers to expose Kubernetes Services as the number of Frontend public IPs on Azure Stack Hub is limited to 5.</span></span> <span data-ttu-id="a559b-250">Dit ontwerp beperkt ook het aantal Kubernetes-Services (met het type LoadBalancer) tot 5, wat te klein is voor veel implementaties.</span><span class="sxs-lookup"><span data-stu-id="a559b-250">This design also limits the number of Kubernetes Services (with the type LoadBalancer) to 5, which will be too small for many deployments.</span></span> <span data-ttu-id="a559b-251">Ga naar de [documentatie](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) van de AKS-engine voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-251">Go to the [AKS Engine documentation](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) to learn more.</span></span>

<span data-ttu-id="a559b-252">Het beschikbaar maken van een toepassing via een openbaar IP-adres via een Load Balancer of een ingangs controller betekent niet nessecarily dat de toepassing nu toegankelijk is via internet.</span><span class="sxs-lookup"><span data-stu-id="a559b-252">Exposing an application using a public IP via a Load Balancer or an Ingress Controller doesn't nessecarily mean that the application is now accessible via the Internet.</span></span> <span data-ttu-id="a559b-253">Het is mogelijk dat Azure Stack hub een openbaar IP-adres heeft dat alleen zichtbaar is op het lokale intranet. niet alle open bare Ip's zijn echt op Internet gericht.</span><span class="sxs-lookup"><span data-stu-id="a559b-253">It's possible for Azure Stack Hub to have a public IP address that is only visible on the local intranet - not all public IPs are truly Internet-facing.</span></span>

<span data-ttu-id="a559b-254">In het vorige blok is het binnenkomend verkeer naar de toepassing beschouwd.</span><span class="sxs-lookup"><span data-stu-id="a559b-254">The previous block considers ingress traffic to the application.</span></span> <span data-ttu-id="a559b-255">Een ander onderwerp dat moet worden overwogen voor een geslaagde implementatie van Kubernetes is uitgaand/uitkomend verkeer.</span><span class="sxs-lookup"><span data-stu-id="a559b-255">Another topic that must be considered for a successful Kubernetes deployment is outbound/egress traffic.</span></span> <span data-ttu-id="a559b-256">Hier volgen enkele gebruiks voorbeelden waarvoor uitgaand verkeer is vereist:</span><span class="sxs-lookup"><span data-stu-id="a559b-256">Here are a few use cases that require egress traffic:</span></span>

- <span data-ttu-id="a559b-257">Container installatie kopieën ophalen die zijn opgeslagen op DockerHub of Azure Container Registry</span><span class="sxs-lookup"><span data-stu-id="a559b-257">Pulling Container Images stored on DockerHub or Azure Container Registry</span></span>
- <span data-ttu-id="a559b-258">Helm-grafieken ophalen</span><span class="sxs-lookup"><span data-stu-id="a559b-258">Retrieving Helm Charts</span></span>
- <span data-ttu-id="a559b-259">Application Insights gegevens (of andere bewakings gegevens) verzenden</span><span class="sxs-lookup"><span data-stu-id="a559b-259">Emitting Application Insights data (or other monitoring data)</span></span>

<span data-ttu-id="a559b-260">Voor sommige bedrijfs omgevingen is het gebruik van _transparante_ of _niet-transparante_ proxy servers vereist.</span><span class="sxs-lookup"><span data-stu-id="a559b-260">Some enterprise environments might require the use of _transparent_ or _non-transparent_ proxy servers.</span></span> <span data-ttu-id="a559b-261">Voor deze servers is specifieke configuratie van de verschillende onderdelen van het cluster vereist.</span><span class="sxs-lookup"><span data-stu-id="a559b-261">These servers require specific configuration on various components of our cluster.</span></span> <span data-ttu-id="a559b-262">De documentatie van de AKS-engine bevat verschillende details over het beheer van netwerkproxys.</span><span class="sxs-lookup"><span data-stu-id="a559b-262">The AKS Engine documentation contains various details on how to accommodate network proxies.</span></span> <span data-ttu-id="a559b-263">Zie [AKS-engine en proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-263">For more details, see [AKS Engine and proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span></span>

<span data-ttu-id="a559b-264">Ten slotte moet verkeer van meerdere clusters stromen tussen Azure Stack hub-instanties.</span><span class="sxs-lookup"><span data-stu-id="a559b-264">Lastly, cross-cluster traffic must flow between Azure Stack Hub instances.</span></span> <span data-ttu-id="a559b-265">De voorbeeld implementatie bestaat uit afzonderlijke Kubernetes-clusters die worden uitgevoerd op afzonderlijke instanties van Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-265">The sample deployment consists of individual Kubernetes clusters running on individual Azure Stack Hub instances.</span></span> <span data-ttu-id="a559b-266">Verkeer ertussen, zoals het replicatie verkeer tussen twee data bases, is externe verkeer.</span><span class="sxs-lookup"><span data-stu-id="a559b-266">Traffic between them, such as the replication traffic between two databases, is "external traffic".</span></span> <span data-ttu-id="a559b-267">Extern verkeer moet worden gerouteerd via een site-naar-site VPN-of Azure Stack hub open bare IP-adressen om verbinding te maken met Kubernetes op twee Azure Stack hub-instanties:</span><span class="sxs-lookup"><span data-stu-id="a559b-267">External traffic must be routed through either a Site-to-Site VPN or Azure Stack Hub Public IP addresses to connect Kubernetes on two Azure Stack Hub instances:</span></span>

![verkeer tussen en binnen cluster](media/pattern-highly-available-kubernetes/aks-inter-and-intra-cluster-traffic.png)

<span data-ttu-id="a559b-269">**Cluster**</span><span class="sxs-lookup"><span data-stu-id="a559b-269">**Cluster**</span></span>  

<span data-ttu-id="a559b-270">Het Kubernetes-cluster hoeft niet noodzakelijkerwijs via internet toegankelijk te zijn.</span><span class="sxs-lookup"><span data-stu-id="a559b-270">The Kubernetes cluster doesn't necessarily need to be accessible via the Internet.</span></span> <span data-ttu-id="a559b-271">Het relevante deel is de Kubernetes-API die wordt gebruikt voor het uitvoeren van een cluster, bijvoorbeeld met behulp van `kubectl` .</span><span class="sxs-lookup"><span data-stu-id="a559b-271">The relevant part is the Kubernetes API used to operate a cluster, for example, using `kubectl`.</span></span> <span data-ttu-id="a559b-272">Het Kubernetes-API-eind punt moet toegankelijk zijn voor iedereen die het cluster exploiteert of toepassingen en services boven op de toepassing implementeert.</span><span class="sxs-lookup"><span data-stu-id="a559b-272">The Kubernetes API endpoint must be accessible to everyone who operates the cluster or deploys applications and services on top of it.</span></span> <span data-ttu-id="a559b-273">In dit onderwerp vindt u meer informatie over een DevOps-perspectief in de sectie [overwegingen voor implementatie (CI/cd)](#deployment-cicd-considerations) hieronder.</span><span class="sxs-lookup"><span data-stu-id="a559b-273">This topic is covered in more detail from a DevOps-perspective in the [Deployment (CI/CD) considerations](#deployment-cicd-considerations) section below.</span></span>

<span data-ttu-id="a559b-274">Op cluster niveau zijn er ook enkele overwegingen rond uitgaand verkeer:</span><span class="sxs-lookup"><span data-stu-id="a559b-274">On the cluster level, there are also a few considerations around egress-traffic:</span></span>

- <span data-ttu-id="a559b-275">Knooppunt updates (voor Ubuntu)</span><span class="sxs-lookup"><span data-stu-id="a559b-275">Node updates (for Ubuntu)</span></span>
- <span data-ttu-id="a559b-276">Bewakings gegevens (verzonden naar Azure LogAnalytics)</span><span class="sxs-lookup"><span data-stu-id="a559b-276">Monitoring data (sent to Azure LogAnalytics)</span></span>
- <span data-ttu-id="a559b-277">Andere agents die uitgaand verkeer vereisen (specifiek voor elke omgeving van de implementatie)</span><span class="sxs-lookup"><span data-stu-id="a559b-277">Other agents requiring outbound traffic (specific to each deployer's environment)</span></span>

<span data-ttu-id="a559b-278">Plan het uiteindelijke netwerk ontwerp voordat u uw Kubernetes-cluster implementeert met behulp van de AKS-engine.</span><span class="sxs-lookup"><span data-stu-id="a559b-278">Before you deploy your Kubernetes cluster using AKS Engine, plan for the final networking design.</span></span> <span data-ttu-id="a559b-279">In plaats van een toegewezen Virtual Network te maken, kan het efficiënter zijn om een cluster in een bestaand netwerk te implementeren.</span><span class="sxs-lookup"><span data-stu-id="a559b-279">Instead of creating a dedicated Virtual Network, it may be more efficient to deploy a cluster into an existing network.</span></span> <span data-ttu-id="a559b-280">U kunt bijvoorbeeld gebruikmaken van een bestaande site-naar-site-VPN-verbinding die al is geconfigureerd in uw Azure Stack hub-omgeving.</span><span class="sxs-lookup"><span data-stu-id="a559b-280">For example, you might leverage an existing Site-to-Site VPN connection already configured in your Azure Stack Hub environment.</span></span>

<span data-ttu-id="a559b-281">**Infrastructuur**</span><span class="sxs-lookup"><span data-stu-id="a559b-281">**Infrastructure**</span></span>  

<span data-ttu-id="a559b-282">Infra structuur verwijst naar toegang tot de Azure Stack hub-beheer eindpunten.</span><span class="sxs-lookup"><span data-stu-id="a559b-282">Infrastructure refers to accessing the Azure Stack Hub management endpoints.</span></span> <span data-ttu-id="a559b-283">Eind punten zijn onder andere de Tenant-en beheer portals en de Azure Resource Manager-beheer-en Tenant-eind punten.</span><span class="sxs-lookup"><span data-stu-id="a559b-283">Endpoints include the tenant and admin portals, and the Azure Resource Manager admin and tenant endpoints.</span></span> <span data-ttu-id="a559b-284">Deze eind punten zijn vereist om Azure Stack hub en de bijbehorende kern services te kunnen uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="a559b-284">These endpoints are required to operate Azure Stack Hub and its core services.</span></span>

## <a name="data-and-storage-considerations"></a><span data-ttu-id="a559b-285">Overwegingen voor gegevens en opslag</span><span class="sxs-lookup"><span data-stu-id="a559b-285">Data and storage considerations</span></span>

<span data-ttu-id="a559b-286">Er worden twee exemplaren van onze toepassing geïmplementeerd op twee afzonderlijke Kubernetes-clusters, in twee Azure Stack hub-instanties.</span><span class="sxs-lookup"><span data-stu-id="a559b-286">Two instances of our application will be deployed, on two individual Kubernetes clusters, across two Azure Stack Hub instances.</span></span> <span data-ttu-id="a559b-287">Aan de hand van dit ontwerp moeten we overwegen hoe u gegevens kunt repliceren en synchroniseren.</span><span class="sxs-lookup"><span data-stu-id="a559b-287">This design will require us to consider how to replicate and synchronize data between them.</span></span>

<span data-ttu-id="a559b-288">Met Azure hebben we de ingebouwde mogelijkheid om opslag te repliceren over meerdere regio's en zones in de Cloud.</span><span class="sxs-lookup"><span data-stu-id="a559b-288">With Azure, we have the built-in capability to replicate storage across multiple regions and zones within the cloud.</span></span> <span data-ttu-id="a559b-289">Momenteel met Azure Stack hub zijn er geen systeem eigen manieren om opslag te repliceren tussen twee verschillende Azure Stack hub-instanties: ze vormen twee onafhankelijke Clouds zonder overkoepelende manier om ze te beheren als een set.</span><span class="sxs-lookup"><span data-stu-id="a559b-289">Currently with Azure Stack Hub there are no native ways to replicate storage across two different Azure Stack Hub instances - they form two independent clouds with no overarching way to manage them as a set.</span></span> <span data-ttu-id="a559b-290">Het plannen van de flexibiliteit van toepassingen die worden uitgevoerd op Azure Stack hub dwingt u uit om deze onafhankelijkheid in het ontwerp en de implementatie van uw toepassing te overwegen.</span><span class="sxs-lookup"><span data-stu-id="a559b-290">Planning for resiliency of applications running across Azure Stack Hub forces you to consider this independence in your application design and deployments.</span></span>

<span data-ttu-id="a559b-291">In de meeste gevallen is opslag replicatie niet nodig voor een robuuste en Maxi maal beschik bare toepassing die op AKS wordt geïmplementeerd.</span><span class="sxs-lookup"><span data-stu-id="a559b-291">In most cases, storage replication won't be necessary for a resilient and highly available application deployed on AKS.</span></span> <span data-ttu-id="a559b-292">U moet echter wel onafhankelijke opslag per Azure Stack hub-exemplaar in het ontwerp van uw toepassing overwegen.</span><span class="sxs-lookup"><span data-stu-id="a559b-292">But you should consider independent storage per Azure Stack Hub instance in your application design.</span></span> <span data-ttu-id="a559b-293">Als dit ontwerp een bezorgdheid-of wegblok is voor het implementeren van de oplossing op Azure Stack hub, zijn er mogelijke oplossingen van micro soft-partners die opslag bijlagen bieden.</span><span class="sxs-lookup"><span data-stu-id="a559b-293">If this design is a concern or road block to deploying the solution on Azure Stack Hub, there are possible solutions from Microsoft Partners that provide storage attachments.</span></span> <span data-ttu-id="a559b-294">Opslag bijlagen bieden een oplossing voor opslag replicatie op meerdere Azure Stack hubs en Azure.</span><span class="sxs-lookup"><span data-stu-id="a559b-294">Storage attachments provide a storage replication solution across multiple Azure Stack Hubs and Azure.</span></span> <span data-ttu-id="a559b-295">Raadpleeg de [partner oplossingen](#partner-solutions)voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-295">For more information, see the [Partner solutions](#partner-solutions).</span></span>

<span data-ttu-id="a559b-296">In onze architectuur werden deze lagen in acht genomen:</span><span class="sxs-lookup"><span data-stu-id="a559b-296">In our architecture, these layers were considered:</span></span>

<span data-ttu-id="a559b-297">**Configuratie**</span><span class="sxs-lookup"><span data-stu-id="a559b-297">**Configuration**</span></span>

<span data-ttu-id="a559b-298">De configuratie bevat de configuratie van Azure Stack hub, de AKS-engine en het Kubernetes-cluster zelf.</span><span class="sxs-lookup"><span data-stu-id="a559b-298">Configuration includes the configuration of Azure Stack Hub, AKS Engine, and the Kubernetes cluster itself.</span></span> <span data-ttu-id="a559b-299">De configuratie moet zo veel mogelijk worden geautomatiseerd en als infrastructuur code worden opgeslagen in een versie beheersysteem op basis van Git, zoals Azure DevOps of GitHub.</span><span class="sxs-lookup"><span data-stu-id="a559b-299">The configuration should be automated as much as possible, and stored as Infrastructure-as-Code in a Git-based version control system like Azure DevOps or GitHub.</span></span> <span data-ttu-id="a559b-300">Deze instellingen kunnen niet eenvoudig worden gesynchroniseerd tussen meerdere implementaties.</span><span class="sxs-lookup"><span data-stu-id="a559b-300">These settings cannot easily be synchronized across multiple deployments.</span></span> <span data-ttu-id="a559b-301">Daarom is het raadzaam om configuratie van buiten te bewaren en toe te passen en DevOps-pijp lijn te gebruiken.</span><span class="sxs-lookup"><span data-stu-id="a559b-301">Therefore we recommend storing and applying configuration from the outside, and using DevOps pipeline.</span></span>

<span data-ttu-id="a559b-302">**Toepassing**</span><span class="sxs-lookup"><span data-stu-id="a559b-302">**Application**</span></span>

<span data-ttu-id="a559b-303">De toepassing moet worden opgeslagen in een opslag plaats op basis van Git.</span><span class="sxs-lookup"><span data-stu-id="a559b-303">The application should be stored in a Git-based repository.</span></span> <span data-ttu-id="a559b-304">Wanneer er een nieuwe implementatie is, wijzigingen in de toepassing of herstel na nood gevallen, kan deze eenvoudig worden geïmplementeerd met behulp van Azure-pijp lijnen.</span><span class="sxs-lookup"><span data-stu-id="a559b-304">Whenever there's a new deployment, changes to the application, or disaster recovery, it can be easily deployed using Azure Pipelines.</span></span>

<span data-ttu-id="a559b-305">**Gegevens**</span><span class="sxs-lookup"><span data-stu-id="a559b-305">**Data**</span></span>

<span data-ttu-id="a559b-306">Gegevens zijn de belangrijkste aandachtspunten voor de meeste toepassings ontwerpen.</span><span class="sxs-lookup"><span data-stu-id="a559b-306">Data is the most important consideration in most application designs.</span></span> <span data-ttu-id="a559b-307">Toepassings gegevens moeten gesynchroniseerd blijven tussen de verschillende exemplaren van de toepassing.</span><span class="sxs-lookup"><span data-stu-id="a559b-307">Application data must stay in sync between the different instances of the application.</span></span> <span data-ttu-id="a559b-308">Gegevens hebben ook een strategie voor back-ups en herstel na nood gevallen nodig als er sprake is van een storing.</span><span class="sxs-lookup"><span data-stu-id="a559b-308">Data also needs a backup and disaster recovery strategy if there's an outage.</span></span>

<span data-ttu-id="a559b-309">Het bereiken van dit ontwerp is sterk afhankelijk van de technologie opties.</span><span class="sxs-lookup"><span data-stu-id="a559b-309">Achieving this design depends heavily on technology choices.</span></span> <span data-ttu-id="a559b-310">Hier volgen enkele voor beelden van oplossingen voor het implementeren van een Data Base op een Maxi maal beschik bare manier op Azure Stack hub:</span><span class="sxs-lookup"><span data-stu-id="a559b-310">Here are some solution examples for implementing a database in a highly available fashion on Azure Stack Hub:</span></span>

- [<span data-ttu-id="a559b-311">Een SQL Server 2016-beschikbaarheids groep implementeren op Azure en Azure Stack hub</span><span class="sxs-lookup"><span data-stu-id="a559b-311">Deploy a SQL Server 2016 availability group to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-sql-ha)
- [<span data-ttu-id="a559b-312">Een Maxi maal beschik bare MongoDB-oplossing implementeren op Azure en Azure Stack hub</span><span class="sxs-lookup"><span data-stu-id="a559b-312">Deploy a highly available MongoDB solution to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-mongodb-ha)

<span data-ttu-id="a559b-313">Overwegingen bij het werken met gegevens op meerdere locaties is een nog complexere overweging voor een Maxi maal beschik bare en robuuste oplossing.</span><span class="sxs-lookup"><span data-stu-id="a559b-313">Considerations when working with data across multiple locations is an even more complex consideration for a highly available and resilient solution.</span></span> <span data-ttu-id="a559b-314">Overweeg het volgende:</span><span class="sxs-lookup"><span data-stu-id="a559b-314">Consider:</span></span>

- <span data-ttu-id="a559b-315">Latentie en netwerk verbinding tussen Azure Stack hubs.</span><span class="sxs-lookup"><span data-stu-id="a559b-315">Latency and network connectivity between Azure Stack Hubs.</span></span>
- <span data-ttu-id="a559b-316">Beschik baarheid van identiteiten voor services en machtigingen.</span><span class="sxs-lookup"><span data-stu-id="a559b-316">Availability of identities for services and permissions.</span></span> <span data-ttu-id="a559b-317">Elk Azure Stack hub-exemplaar kan worden geïntegreerd met een externe map.</span><span class="sxs-lookup"><span data-stu-id="a559b-317">Each Azure Stack Hub instance integrates with an external directory.</span></span> <span data-ttu-id="a559b-318">Tijdens de implementatie kunt u Azure Active Directory (Azure AD) of Active Directory Federation Services (ADFS) gebruiken.</span><span class="sxs-lookup"><span data-stu-id="a559b-318">During deployment, you choose to use either Azure Active Directory (Azure AD) or Active Directory Federation Services (ADFS).</span></span> <span data-ttu-id="a559b-319">Het is dus mogelijk om één identiteit te gebruiken die kan communiceren met meerdere onafhankelijke instanties van Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-319">As such, there's potential to use a single identity that can interact with multiple independent Azure Stack Hub instances.</span></span>

## <a name="business-continuity-and-disaster-recovery"></a><span data-ttu-id="a559b-320">Bedrijfscontinuïteit en herstel na noodgevallen</span><span class="sxs-lookup"><span data-stu-id="a559b-320">Business continuity and disaster recovery</span></span>

<span data-ttu-id="a559b-321">Bedrijfs continuïteit en herstel na nood gevallen (BCDR) is een belang rijk onderwerp in zowel Azure Stack hub als Azure.</span><span class="sxs-lookup"><span data-stu-id="a559b-321">Business continuity and disaster recovery (BCDR) is an important topic in both Azure Stack Hub and Azure.</span></span> <span data-ttu-id="a559b-322">Het belangrijkste verschil is dat de operator in Azure Stack hub het hele BCDR-proces moet beheren.</span><span class="sxs-lookup"><span data-stu-id="a559b-322">The main difference is that in Azure Stack Hub, the operator must manage the whole BCDR process.</span></span> <span data-ttu-id="a559b-323">In Azure worden delen van BCDR automatisch beheerd door micro soft.</span><span class="sxs-lookup"><span data-stu-id="a559b-323">In Azure, parts of BCDR are automatically managed by Microsoft.</span></span>

<span data-ttu-id="a559b-324">BCDR is van invloed op dezelfde gebieden als beschreven in de vorige sectie [gegevens en opslag overwegingen](#data-and-storage-considerations):</span><span class="sxs-lookup"><span data-stu-id="a559b-324">BCDR affects the same areas mentioned in the previous section [Data and storage considerations](#data-and-storage-considerations):</span></span>

- <span data-ttu-id="a559b-325">Infra structuur/configuratie</span><span class="sxs-lookup"><span data-stu-id="a559b-325">Infrastructure / Configuration</span></span>
- <span data-ttu-id="a559b-326">Toepassings beschikbaarheid</span><span class="sxs-lookup"><span data-stu-id="a559b-326">Application Availability</span></span>
- <span data-ttu-id="a559b-327">Toepassingsgegevens</span><span class="sxs-lookup"><span data-stu-id="a559b-327">Application Data</span></span>

<span data-ttu-id="a559b-328">En zoals vermeld in de vorige sectie, zijn deze gebieden de verantwoordelijkheid van de operator Azure Stack hub en kunnen verschillen tussen organisaties.</span><span class="sxs-lookup"><span data-stu-id="a559b-328">And as mentioned in the previous section, these areas are the responsibility of the Azure Stack Hub operator and can vary between organizations.</span></span> <span data-ttu-id="a559b-329">Plan BCDR volgens uw beschik bare Program ma's en processen.</span><span class="sxs-lookup"><span data-stu-id="a559b-329">Plan BCDR according to your available tools and processes.</span></span>

<span data-ttu-id="a559b-330">**Infra structuur en configuratie**</span><span class="sxs-lookup"><span data-stu-id="a559b-330">**Infrastructure and configuration**</span></span>

<span data-ttu-id="a559b-331">In deze sectie worden de fysieke en logische infra structuur en de configuratie van Azure Stack hub beschreven.</span><span class="sxs-lookup"><span data-stu-id="a559b-331">This section covers the physical and logical infrastructure and the configuration of Azure Stack Hub.</span></span> <span data-ttu-id="a559b-332">Het behandelt acties in de beheerder en de Tenant ruimten.</span><span class="sxs-lookup"><span data-stu-id="a559b-332">It covers actions in the admin and the tenant spaces.</span></span>

<span data-ttu-id="a559b-333">De operator voor de Azure Stack hub (of beheerder) is verantwoordelijk voor het onderhoud van de instanties van de Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-333">The Azure Stack Hub operator (or administrator) is responsible for maintenance of the Azure Stack Hub instances.</span></span> <span data-ttu-id="a559b-334">Inclusief onderdelen zoals het netwerk, de opslag, de identiteit en andere onderwerpen die buiten het bereik van dit artikel vallen.</span><span class="sxs-lookup"><span data-stu-id="a559b-334">Including components such as the network, storage, identity, and other topics that are outside the scope of this article.</span></span> <span data-ttu-id="a559b-335">Raadpleeg de volgende bronnen voor meer informatie over de details van Azure Stack hub-bewerkingen:</span><span class="sxs-lookup"><span data-stu-id="a559b-335">To learn more about the specifics of Azure Stack Hub operations, see the following resources:</span></span>

- [<span data-ttu-id="a559b-336">Gegevens in Azure Stack hub herstellen met de Infrastructure Backup-Service</span><span class="sxs-lookup"><span data-stu-id="a559b-336">Recover data in Azure Stack Hub with the Infrastructure Backup Service</span></span>](/azure-stack/operator/azure-stack-backup-infrastructure-backup)
- [<span data-ttu-id="a559b-337">Back-up voor Azure Stack hub inschakelen vanuit de beheer Portal</span><span class="sxs-lookup"><span data-stu-id="a559b-337">Enable backup for Azure Stack Hub from the administrator portal</span></span>](/azure-stack/operator/azure-stack-backup-enable-backup-console)
- [<span data-ttu-id="a559b-338">Herstellen van onherstelbaar gegevensverlies</span><span class="sxs-lookup"><span data-stu-id="a559b-338">Recover from catastrophic data loss</span></span>](/azure-stack/operator/azure-stack-backup-recover-data)
- [<span data-ttu-id="a559b-339">Aanbevolen procedures voor de service Infrastructure Backup</span><span class="sxs-lookup"><span data-stu-id="a559b-339">Infrastructure Backup Service best practices</span></span>](/azure-stack/operator/azure-stack-backup-best-practices)

<span data-ttu-id="a559b-340">Azure Stack hub is het platform en de infra structuur waarop Kubernetes toepassingen worden geïmplementeerd.</span><span class="sxs-lookup"><span data-stu-id="a559b-340">Azure Stack Hub is the platform and fabric on which Kubernetes applications will be deployed.</span></span> <span data-ttu-id="a559b-341">De eigenaar van de toepassing voor de Kubernetes-toepassing is een gebruiker van Azure Stack hub, waarvoor toegang is verleend om de toepassings infrastructuur te implementeren die nodig is voor de oplossing.</span><span class="sxs-lookup"><span data-stu-id="a559b-341">The application owner for the Kubernetes application will be a user of Azure Stack Hub, with access granted to deploy the application infrastructure needed for the solution.</span></span> <span data-ttu-id="a559b-342">Toepassings infrastructuur in dit geval betekent het Kubernetes-cluster, geïmplementeerd met behulp van de AKS-engine en de omringende Services.</span><span class="sxs-lookup"><span data-stu-id="a559b-342">Application infrastructure in this case means the Kubernetes cluster, deployed using AKS Engine, and the surrounding services.</span></span> <span data-ttu-id="a559b-343">Deze onderdelen worden geïmplementeerd in Azure Stack hub, beperkt door een Azure Stack hub-aanbieding.</span><span class="sxs-lookup"><span data-stu-id="a559b-343">These components will be deployed into Azure Stack Hub, constrained by an Azure Stack Hub offer.</span></span> <span data-ttu-id="a559b-344">Zorg ervoor dat de aanbieding die door de eigenaar van de Kubernetes-toepassing is geaccepteerd, voldoende capaciteit heeft (uitgedrukt in Azure Stack hub-quota's) om de volledige oplossing te implementeren.</span><span class="sxs-lookup"><span data-stu-id="a559b-344">Make sure the offer accepted by the Kubernetes application owner has sufficient capacity (expressed in Azure Stack Hub quotas) to deploy the entire solution.</span></span> <span data-ttu-id="a559b-345">Zoals aanbevolen in de vorige sectie, moet de toepassings implementatie worden geautomatiseerd met behulp van infrastructuur codes en implementatie pijplijnen zoals Azure DevOps Azure-pijp lijnen.</span><span class="sxs-lookup"><span data-stu-id="a559b-345">As recommended in the previous section, the application deployment should be automated using Infrastructure-as-Code and deployment pipelines like Azure DevOps Azure Pipelines.</span></span>

<span data-ttu-id="a559b-346">Zie [Azure stack hub Services, plannen, aanbiedingen en abonnementen Overview](/azure-stack/operator/service-plan-offer-subscription-overview) voor meer informatie over Azure stack hub en quota's.</span><span class="sxs-lookup"><span data-stu-id="a559b-346">For more information on Azure Stack Hub offers and quotas, see [Azure Stack Hub services, plans, offers, and subscriptions overview](/azure-stack/operator/service-plan-offer-subscription-overview)</span></span>

<span data-ttu-id="a559b-347">Het is belang rijk om de configuratie van de AKS-engine veilig op te slaan en op te slaan, inclusief de uitvoer.</span><span class="sxs-lookup"><span data-stu-id="a559b-347">It's important to securely save and store the AKS Engine configuration including its outputs.</span></span> <span data-ttu-id="a559b-348">Deze bestanden bevatten vertrouwelijke informatie die wordt gebruikt voor toegang tot het Kubernetes-cluster. Daarom moet het worden beschermd tegen niet-beheerders.</span><span class="sxs-lookup"><span data-stu-id="a559b-348">These files contain confidential information used to access the Kubernetes cluster, so it must be protected from being exposed to non-administrators.</span></span>

<span data-ttu-id="a559b-349">**Toepassings beschikbaarheid**</span><span class="sxs-lookup"><span data-stu-id="a559b-349">**Application availability**</span></span>

<span data-ttu-id="a559b-350">De toepassing hoeft niet te vertrouwen op back-ups van een geïmplementeerd exemplaar.</span><span class="sxs-lookup"><span data-stu-id="a559b-350">The application shouldn't rely on backups of a deployed instance.</span></span> <span data-ttu-id="a559b-351">Als standaard procedure implementeert u de toepassing volledig na de infra structuur-as-code-patronen.</span><span class="sxs-lookup"><span data-stu-id="a559b-351">As a standard practice, redeploy the application completely following Infrastructure-as-Code patterns.</span></span> <span data-ttu-id="a559b-352">Implementeer bijvoorbeeld opnieuw met Azure DevOps Azure-pijp lijnen.</span><span class="sxs-lookup"><span data-stu-id="a559b-352">For example, redeploy using Azure DevOps Azure Pipelines.</span></span> <span data-ttu-id="a559b-353">De BCDR-procedure moet de toepassing opnieuw implementeren naar dezelfde of een andere Kubernetes-cluster.</span><span class="sxs-lookup"><span data-stu-id="a559b-353">The BCDR procedure should involve the redeployment of the application to the same or another Kubernetes cluster.</span></span>

<span data-ttu-id="a559b-354">**Toepassings gegevens**</span><span class="sxs-lookup"><span data-stu-id="a559b-354">**Application data**</span></span>

<span data-ttu-id="a559b-355">Toepassings gegevens vormen een belang rijk onderdeel om gegevens verlies te minimaliseren.</span><span class="sxs-lookup"><span data-stu-id="a559b-355">Application data is the critical part to minimize data loss.</span></span> <span data-ttu-id="a559b-356">In de vorige sectie zijn technieken voor het repliceren en synchroniseren van gegevens tussen twee (of meer) exemplaren van de toepassing beschreven.</span><span class="sxs-lookup"><span data-stu-id="a559b-356">In the previous section, techniques to replicate and synchronize data between two (or more) instances of the application were described.</span></span> <span data-ttu-id="a559b-357">Afhankelijk van de database infrastructuur (MySQL, MongoDB, MSSQL of anderen) die wordt gebruikt om de gegevens op te slaan, zijn er verschillende Beschik baarheid van de data base en back-uptechnieken beschikbaar om uit te kiezen.</span><span class="sxs-lookup"><span data-stu-id="a559b-357">Depending on the database infrastructure (MySQL, MongoDB, MSSQL or others) used to store the data, there will be different database availability and backup techniques available to choose from.</span></span>

<span data-ttu-id="a559b-358">De aanbevolen manieren om integriteit te waarborgen zijn:</span><span class="sxs-lookup"><span data-stu-id="a559b-358">The recommended ways to achieve integrity are to use either:</span></span>
- <span data-ttu-id="a559b-359">Een systeem eigen back-upoplossing voor de specifieke data base.</span><span class="sxs-lookup"><span data-stu-id="a559b-359">A native backup solution for the specific database.</span></span>
- <span data-ttu-id="a559b-360">Een back-upoplossing die officieel ondersteuning biedt voor back-up en herstel van het database type dat door uw toepassing wordt gebruikt.</span><span class="sxs-lookup"><span data-stu-id="a559b-360">A backup solution that officially supports backup and recovery of the database type used by your application.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a559b-361">Sla uw back-upgegevens niet op hetzelfde Azure Stack hub-exemplaar op waar de toepassings gegevens zich bevinden.</span><span class="sxs-lookup"><span data-stu-id="a559b-361">Do not store your backup data on the same Azure Stack Hub instance where your application data resides.</span></span> <span data-ttu-id="a559b-362">Een volledige storing van het Azure Stack hub-exemplaar zou ook een inbreuk op uw back-ups veroorzaken.</span><span class="sxs-lookup"><span data-stu-id="a559b-362">A complete outage of the Azure Stack Hub instance would also compromise your backups.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="a559b-363">Beschikbaarheidsoverwegingen</span><span class="sxs-lookup"><span data-stu-id="a559b-363">Availability considerations</span></span>

<span data-ttu-id="a559b-364">Kubernetes op Azure Stack hub die via de AKS-engine is geïmplementeerd, is geen beheerde service.</span><span class="sxs-lookup"><span data-stu-id="a559b-364">Kubernetes on Azure Stack Hub deployed via AKS Engine isn't a managed service.</span></span> <span data-ttu-id="a559b-365">Het is een geautomatiseerde implementatie en configuratie van een Kubernetes-cluster met behulp van Azure Infrastructure-as-a-Service (IaaS).</span><span class="sxs-lookup"><span data-stu-id="a559b-365">It's an automated deployment and configuration of a Kubernetes cluster using Azure Infrastructure-as-a-Service (IaaS).</span></span> <span data-ttu-id="a559b-366">Dit biedt dezelfde Beschik baarheid als de onderliggende infra structuur.</span><span class="sxs-lookup"><span data-stu-id="a559b-366">As such, it provides the same availability as the underlying infrastructure.</span></span>

<span data-ttu-id="a559b-367">Azure Stack hub-infra structuur is al flexibel voor fouten en biedt mogelijkheden als beschikbaarheids sets voor het distribueren van onderdelen over meerdere [fout-en update domeinen](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span><span class="sxs-lookup"><span data-stu-id="a559b-367">Azure Stack Hub infrastructure is already resilient to failures, and provides capabilities like Availability Sets to distribute components across multiple [fault and update domains](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span></span> <span data-ttu-id="a559b-368">Maar de onderliggende technologie (failover clustering) heeft nog steeds enige downtime voor Vm's op een betrokken fysieke server, als er sprake is van een hardwarestoring.</span><span class="sxs-lookup"><span data-stu-id="a559b-368">But the underlying technology (failover clustering) still incurs some downtime for VMs on an impacted physical server, if there's a hardware failure.</span></span>

<span data-ttu-id="a559b-369">Het is een goed idee om uw productie Kubernetes-cluster en de werk belasting op twee (of meer) clusters te implementeren.</span><span class="sxs-lookup"><span data-stu-id="a559b-369">It's a good practice to deploy your production Kubernetes cluster as well as the workload to two (or more) clusters.</span></span> <span data-ttu-id="a559b-370">Deze clusters moeten worden gehost op verschillende locaties of data centers en technologieën zoals Azure Traffic Manager gebruiken om gebruikers te routeren op basis van de reactie tijd van een cluster of op basis van geografie.</span><span class="sxs-lookup"><span data-stu-id="a559b-370">These clusters should be hosted in different locations or datacenters, and use technologies like Azure Traffic Manager to route users based on cluster response time or based on geography.</span></span>

![De verkeers stromen met behulp van Traffic Manager beheren](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager.png)

<span data-ttu-id="a559b-372">Klanten met één Kubernetes-cluster maken doorgaans verbinding met het service-IP-adres of de DNS-naam van een bepaalde toepassing.</span><span class="sxs-lookup"><span data-stu-id="a559b-372">Customers who have a single Kubernetes cluster typically connect to the service IP or DNS name of a given application.</span></span> <span data-ttu-id="a559b-373">In een implementatie met meerdere clusters moeten klanten verbinding maken met een Traffic Manager DNS-naam die verwijst naar de services/binnenkomend op elk Kubernetes-cluster.</span><span class="sxs-lookup"><span data-stu-id="a559b-373">In a multi-cluster deployment, customers should connect to a Traffic Manager DNS name that points to the services/ingress on each Kubernetes cluster.</span></span>

![Traffic Manager gebruiken om naar een on-premises cluster te routeren](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager-on-premises.png)

> [!NOTE]
> <span data-ttu-id="a559b-375">Dit patroon is ook een [Best Practice voor (beheerde) AKS-clusters in azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span><span class="sxs-lookup"><span data-stu-id="a559b-375">This pattern is also a [best practice for (managed) AKS clusters in Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span></span>

<span data-ttu-id="a559b-376">Het Kubernetes-cluster zelf, geïmplementeerd via de AKS-engine, moet bestaan uit ten minste drie hoofd knooppunten en twee worker-knoop punten.</span><span class="sxs-lookup"><span data-stu-id="a559b-376">The Kubernetes cluster itself, deployed via AKS Engine, should consist of at least three master nodes and two worker nodes.</span></span>

## <a name="identity-and-security-considerations"></a><span data-ttu-id="a559b-377">Identiteits-en beveiligings overwegingen</span><span class="sxs-lookup"><span data-stu-id="a559b-377">Identity and security considerations</span></span>

<span data-ttu-id="a559b-378">Identiteit en beveiliging zijn belang rijke onderwerpen.</span><span class="sxs-lookup"><span data-stu-id="a559b-378">Identity and security are important topics.</span></span> <span data-ttu-id="a559b-379">Met name wanneer de oplossing onafhankelijk Azure Stack hub-instanties omvat.</span><span class="sxs-lookup"><span data-stu-id="a559b-379">Especially when the solution spans independent Azure Stack Hub instances.</span></span> <span data-ttu-id="a559b-380">Kubernetes en Azure (inclusief Azure Stack hub) hebben beide verschillende mechanismen voor op rollen gebaseerd toegangs beheer (RBAC):</span><span class="sxs-lookup"><span data-stu-id="a559b-380">Kubernetes and Azure (including Azure Stack Hub) both have distinct mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="a559b-381">Azure RBAC beheert de toegang tot resources in azure (en Azure Stack hub), met inbegrip van de mogelijkheid om nieuwe Azure-resources te maken.</span><span class="sxs-lookup"><span data-stu-id="a559b-381">Azure RBAC controls access to resources in Azure (and Azure Stack Hub), including the ability to create new Azure resources.</span></span> <span data-ttu-id="a559b-382">Machtigingen kunnen worden toegewezen aan gebruikers, groepen of service-principals.</span><span class="sxs-lookup"><span data-stu-id="a559b-382">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="a559b-383">(Een Service-Principal is een beveiligings identiteit die door toepassingen wordt gebruikt.)</span><span class="sxs-lookup"><span data-stu-id="a559b-383">(A service principal is a security identity used by applications.)</span></span>
- <span data-ttu-id="a559b-384">Kubernetes RBAC beheert machtigingen voor de Kubernetes-API.</span><span class="sxs-lookup"><span data-stu-id="a559b-384">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="a559b-385">Een voor beeld: het maken van een Peul en het weer geven van peulen zijn acties die kunnen worden toegestaan (of geweigerd) aan een gebruiker via RBAC.</span><span class="sxs-lookup"><span data-stu-id="a559b-385">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="a559b-386">Als u Kubernetes-machtigingen aan gebruikers wilt toewijzen, maakt u rollen en rollen bindingen.</span><span class="sxs-lookup"><span data-stu-id="a559b-386">To assign Kubernetes permissions to users, you create roles and role bindings.</span></span>

<span data-ttu-id="a559b-387">**Azure Stack hub-identiteit en RBAC**</span><span class="sxs-lookup"><span data-stu-id="a559b-387">**Azure Stack Hub identity and RBAC**</span></span>

<span data-ttu-id="a559b-388">Azure Stack hub biedt twee opties voor de ID-provider.</span><span class="sxs-lookup"><span data-stu-id="a559b-388">Azure Stack Hub provides two identity provider choices.</span></span> <span data-ttu-id="a559b-389">De provider die u gebruikt, is afhankelijk van de omgeving en of deze wordt uitgevoerd in een verbonden of niet-verbonden omgeving:</span><span class="sxs-lookup"><span data-stu-id="a559b-389">The provider you use depends on the environment and whether running in a connected or disconnected environment:</span></span>

- <span data-ttu-id="a559b-390">Azure AD: kan alleen worden gebruikt in een verbonden omgeving.</span><span class="sxs-lookup"><span data-stu-id="a559b-390">Azure AD - can only be used in a connected environment.</span></span>
- <span data-ttu-id="a559b-391">ADFS naar een traditioneel Active Directory forest: kan worden gebruikt in een verbonden of niet-verbonden omgeving.</span><span class="sxs-lookup"><span data-stu-id="a559b-391">ADFS to a traditional Active Directory forest - can be used in both a connected or disconnected environment.</span></span>

<span data-ttu-id="a559b-392">De ID-provider beheert gebruikers en groepen, met inbegrip van verificatie en autorisatie voor toegang tot resources.</span><span class="sxs-lookup"><span data-stu-id="a559b-392">The identity provider manages users and groups, including authentication and authorization for accessing resources.</span></span> <span data-ttu-id="a559b-393">Toegang kan worden verleend aan Azure Stack hub-resources, zoals abonnementen, resource groepen en individuele resources, zoals Vm's of load balancers.</span><span class="sxs-lookup"><span data-stu-id="a559b-393">Access can be granted to Azure Stack Hub resources like subscriptions, resource groups, and individual resources like VMs or load balancers.</span></span> <span data-ttu-id="a559b-394">Als u een consistent toegangs model wilt hebben, kunt u overwegen om dezelfde groepen (direct of genest) te gebruiken voor alle Azure Stack hubs.</span><span class="sxs-lookup"><span data-stu-id="a559b-394">To have a consistent access model, you should consider using the same groups (either direct or nested) for all Azure Stack Hubs.</span></span> <span data-ttu-id="a559b-395">Hier volgt een voor beeld van een configuratie:</span><span class="sxs-lookup"><span data-stu-id="a559b-395">Here's a configuration example:</span></span>

![geneste Aad-groepen met Azure stack-hub](media/pattern-highly-available-kubernetes/azure-stack-azure-ad-nested-groups.png)

<span data-ttu-id="a559b-397">Het voor beeld bevat een specifieke groep (met AAD of ADFS) voor een specifiek doel.</span><span class="sxs-lookup"><span data-stu-id="a559b-397">The example contains a dedicated group (using AAD or ADFS) for a specific purpose.</span></span> <span data-ttu-id="a559b-398">Als u bijvoorbeeld Inzender machtigingen wilt verlenen voor de resource groep met de Kubernetes-cluster infrastructuur op een specifiek Azure Stack hub-exemplaar (hier ' Seattle K8s cluster contributor ').</span><span class="sxs-lookup"><span data-stu-id="a559b-398">For example, to provide Contributor permissions for the Resource Group that contains our Kubernetes cluster infrastructure on a specific Azure Stack Hub instance (here "Seattle K8s Cluster Contributor").</span></span> <span data-ttu-id="a559b-399">Deze groepen worden vervolgens genest in een algemene groep die de subgroepen bevat voor elke Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-399">These groups are then nested into an overall group that contains the "subgroups" for each Azure Stack Hub.</span></span>

<span data-ttu-id="a559b-400">Onze voorbeeld gebruiker heeft nu machtigingen voor ' Inzender ' voor beide resource groepen die de volledige set Kubernetes-infrastructuur resources bevatten.</span><span class="sxs-lookup"><span data-stu-id="a559b-400">Our sample user will now have "Contributor" permissions to both Resources Groups that contain the entire set of Kubernetes infrastructure resources.</span></span> <span data-ttu-id="a559b-401">De gebruiker heeft toegang tot resources op beide Azure Stack hub-instanties, omdat de instanties dezelfde id-provider delen.</span><span class="sxs-lookup"><span data-stu-id="a559b-401">The user will have access to resources on both Azure Stack Hub instances, because the instances share the same identity provider.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a559b-402">Deze machtigingen zijn alleen van invloed op Azure Stack hub en enkele van de resources die hierop zijn geïmplementeerd.</span><span class="sxs-lookup"><span data-stu-id="a559b-402">These permissions affect only Azure Stack Hub and some of the resources deployed on top of it.</span></span> <span data-ttu-id="a559b-403">Een gebruiker met dit toegangs niveau kan een hoop beschadiging doen, maar heeft geen toegang tot de Kubernetes IaaS Vm's en de Kubernetes-API zonder extra toegang tot de Kubernetes-implementatie.</span><span class="sxs-lookup"><span data-stu-id="a559b-403">A user who has this level of access can do a lot of harm, but cannot access the Kubernetes IaaS VMs nor the Kubernetes API without additional access to the Kubernetes deployment.</span></span>

<span data-ttu-id="a559b-404">**Kubernetes identiteit en RBAC**</span><span class="sxs-lookup"><span data-stu-id="a559b-404">**Kubernetes identity and RBAC**</span></span>

<span data-ttu-id="a559b-405">Voor een Kubernetes-cluster wordt standaard niet dezelfde id-provider gebruikt als voor de Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-405">A Kubernetes cluster, by default, doesn't use the same Identity Provider as the underlaying Azure Stack Hub.</span></span> <span data-ttu-id="a559b-406">De virtuele machines die het Kubernetes-cluster, de Master-en worker-knoop punten hosten, gebruiken de SSH-sleutel die is opgegeven tijdens de implementatie van het cluster.</span><span class="sxs-lookup"><span data-stu-id="a559b-406">The VMs hosting the Kubernetes cluster, the master, and worker nodes, use the SSH Key that is specified during the deployment of the cluster.</span></span> <span data-ttu-id="a559b-407">Deze SSH-sleutel is vereist om via SSH verbinding te maken met deze knoop punten.</span><span class="sxs-lookup"><span data-stu-id="a559b-407">This SSH key is required to connect to these nodes using SSH.</span></span>

<span data-ttu-id="a559b-408">De Kubernetes-API (bijvoorbeeld toegankelijk via `kubectl` ) wordt ook beveiligd door service accounts, met inbegrip van een standaard-Cluster Administrator-Service account.</span><span class="sxs-lookup"><span data-stu-id="a559b-408">The Kubernetes API (for example, accessed by using `kubectl`) is also protected by service accounts including a default "cluster admin" service account.</span></span> <span data-ttu-id="a559b-409">De referenties voor dit service account worden in eerste instantie opgeslagen in het `.kube/config` bestand op uw Kubernetes-hoofd knooppunten.</span><span class="sxs-lookup"><span data-stu-id="a559b-409">The credentials for this service account are initially stored in the `.kube/config` file on your Kubernetes master nodes.</span></span>

<span data-ttu-id="a559b-410">**Beheer-en toepassings referenties voor geheimen**</span><span class="sxs-lookup"><span data-stu-id="a559b-410">**Secrets management and application credentials**</span></span>

<span data-ttu-id="a559b-411">Om geheimen zoals verbindings reeksen of database referenties op te slaan, zijn er verschillende opties, waaronder:</span><span class="sxs-lookup"><span data-stu-id="a559b-411">To store secrets like connection strings or database credentials there are several choices, including:</span></span>

- <span data-ttu-id="a559b-412">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="a559b-412">Azure Key Vault</span></span>
- <span data-ttu-id="a559b-413">Kubernetes Secrets</span><span class="sxs-lookup"><span data-stu-id="a559b-413">Kubernetes Secrets</span></span>
- <span data-ttu-id="a559b-414">oplossingen van derden, zoals HashiCorp-kluis (uitgevoerd op Kubernetes)</span><span class="sxs-lookup"><span data-stu-id="a559b-414">3rd-Party solutions like HashiCorp Vault (running on Kubernetes)</span></span>

<span data-ttu-id="a559b-415">Sla geheimen of referenties niet op als tekst zonder opmaak in uw configuratie bestanden, toepassings code of in scripts.</span><span class="sxs-lookup"><span data-stu-id="a559b-415">Do not store secrets or credentials in plaintext in your configuration files, application code, or within scripts.</span></span> <span data-ttu-id="a559b-416">En sla ze niet op in een versie beheersysteem.</span><span class="sxs-lookup"><span data-stu-id="a559b-416">And do not store them in a version control system.</span></span> <span data-ttu-id="a559b-417">In plaats daarvan moeten de geheimen zo nodig worden opgehaald door de implementatie automatisering.</span><span class="sxs-lookup"><span data-stu-id="a559b-417">Instead, the deployment automation should retrieve the secrets as needed.</span></span>

## <a name="patch-and-update"></a><span data-ttu-id="a559b-418">Patch en update</span><span class="sxs-lookup"><span data-stu-id="a559b-418">Patch and update</span></span>

<span data-ttu-id="a559b-419">Het proces **patch en update (PNU)** in de Azure Kubernetes-service is gedeeltelijk geautomatiseerd.</span><span class="sxs-lookup"><span data-stu-id="a559b-419">The **Patch and Update (PNU)** process in Azure Kubernetes Service is partially automated.</span></span> <span data-ttu-id="a559b-420">Kubernetes-versie-upgrades worden hand matig geactiveerd, terwijl beveiligings updates automatisch worden toegepast.</span><span class="sxs-lookup"><span data-stu-id="a559b-420">Kubernetes version upgrades are triggered manually, while security updates are applied automatically.</span></span> <span data-ttu-id="a559b-421">Deze updates kunnen bestaan uit beveiligings correcties voor het besturings systeem of kernel-updates.</span><span class="sxs-lookup"><span data-stu-id="a559b-421">These updates can include OS security fixes or kernel updates.</span></span> <span data-ttu-id="a559b-422">AKS start deze Linux-knoop punten niet automatisch opnieuw op om het update proces te volt ooien.</span><span class="sxs-lookup"><span data-stu-id="a559b-422">AKS doesn't automatically reboot these Linux nodes to complete the update process.</span></span> 

<span data-ttu-id="a559b-423">Het PNU-proces voor een Kubernetes-cluster dat is geïmplementeerd met behulp van AKS-engine op Azure Stack hub, is onbeheerd en is de verantwoordelijkheid van de cluster operator.</span><span class="sxs-lookup"><span data-stu-id="a559b-423">The PNU process for a Kubernetes cluster deployed using AKS Engine on Azure Stack Hub is unmanaged, and is the responsibility of the cluster operator.</span></span> 

<span data-ttu-id="a559b-424">De AKS-engine helpt bij de twee belangrijkste taken:</span><span class="sxs-lookup"><span data-stu-id="a559b-424">AKS Engine helps with the two most important tasks:</span></span>

- [<span data-ttu-id="a559b-425">Upgrade naar een nieuwere versie van de installatie kopie voor Kubernetes en Base OS</span><span class="sxs-lookup"><span data-stu-id="a559b-425">Upgrade to a newer Kubernetes and base OS image version</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-upgrade-to-a-newer-kubernetes-version)
- [<span data-ttu-id="a559b-426">Alleen de basis installatie kopie van het besturings systeem bijwerken</span><span class="sxs-lookup"><span data-stu-id="a559b-426">Upgrade the base OS image only</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-only-upgrade-the-os-image)

<span data-ttu-id="a559b-427">Nieuwere basis installatie kopieën van het besturings systeem bevatten de nieuwste beveiligingsfixes en kernel-updates.</span><span class="sxs-lookup"><span data-stu-id="a559b-427">Newer base OS images contain the latest OS security fixes and kernel updates.</span></span> 

<span data-ttu-id="a559b-428">Met het mechanisme voor [upgrade zonder toezicht](https://wiki.debian.org/UnattendedUpgrades) worden automatisch beveiligings updates geïnstalleerd die worden uitgebracht voordat een nieuwe versie van de installatie kopie van het basis besturingssysteem beschikbaar is in de Azure stack hub Marketplace.</span><span class="sxs-lookup"><span data-stu-id="a559b-428">The [Unattended Upgrade](https://wiki.debian.org/UnattendedUpgrades) mechanism automatically installs security updates that are released before a new base OS image version is available in the Azure Stack Hub Marketplace.</span></span> <span data-ttu-id="a559b-429">De upgrade voor een installatie zonder toezicht is standaard ingeschakeld en de beveiligings updates worden automatisch geïnstalleerd, maar de Kubernetes-cluster knooppunten worden niet opnieuw opgestart.</span><span class="sxs-lookup"><span data-stu-id="a559b-429">Unattended upgrade is enabled by default and installs security updates automatically, but does not reboot the Kubernetes cluster nodes.</span></span> <span data-ttu-id="a559b-430">Het opnieuw opstarten van de knoop punten kan worden geautomatiseerd met behulp van de open-source [ **K** Ubernetes **opnieuw** opstarten **D** Aemon (kured))](/azure/aks/node-updates-kured).</span><span class="sxs-lookup"><span data-stu-id="a559b-430">Rebooting the nodes can be automated using the open-source [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured).</span></span> <span data-ttu-id="a559b-431">Kured controleert voor Linux-knoop punten die opnieuw moeten worden opgestart en verwerkt vervolgens automatisch het opnieuw plannen van het uitvoeren van het proces en het opnieuw opstarten van het knoop punt.</span><span class="sxs-lookup"><span data-stu-id="a559b-431">Kured watches for Linux nodes that require a reboot, then automatically handle the rescheduling of running pods and node reboot process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="a559b-432">Overwegingen voor implementatie (CI/CD)</span><span class="sxs-lookup"><span data-stu-id="a559b-432">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="a559b-433">Azure en Azure Stack hub bieden dezelfde Azure Resource Manager REST-Api's.</span><span class="sxs-lookup"><span data-stu-id="a559b-433">Azure and Azure Stack Hub expose the same Azure Resource Manager REST APIs.</span></span> <span data-ttu-id="a559b-434">Deze Api's worden geadresseerd, zoals elke andere Azure-Cloud (Azure, Azure-China 21Vianet, Azure Government).</span><span class="sxs-lookup"><span data-stu-id="a559b-434">These APIs are addressed like any other Azure cloud (Azure, Azure China 21Vianet, Azure Government).</span></span> <span data-ttu-id="a559b-435">Er zijn mogelijk verschillen in API-versies tussen Clouds en Azure Stack hub biedt slechts een subset van services.</span><span class="sxs-lookup"><span data-stu-id="a559b-435">There may be differences in API versions between clouds, and Azure Stack Hub provides only a subset of services.</span></span> <span data-ttu-id="a559b-436">De URI van het beheer eindpunt verschilt ook voor elke Cloud en voor elk exemplaar van Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-436">The management endpoint URI is also different for each cloud, and each instance of Azure Stack Hub.</span></span>

<span data-ttu-id="a559b-437">Azure Resource Manager REST Api's bieden een consistente manier om te communiceren met zowel Azure als Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-437">Aside from the subtle differences mentioned, Azure Resource Manager REST APIs provide a consistent way to interact with both Azure and Azure Stack Hub.</span></span> <span data-ttu-id="a559b-438">U kunt hier dezelfde set hulpprogram ma's gebruiken als voor andere Azure-Clouds.</span><span class="sxs-lookup"><span data-stu-id="a559b-438">The same set of tools can be used here as would be used with any other Azure cloud.</span></span> <span data-ttu-id="a559b-439">U kunt Azure DevOps, hulpprogram ma's zoals Jenkins of Power shell, gebruiken om services te implementeren en te organiseren voor Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-439">You can use Azure DevOps, tools like Jenkins, or PowerShell, to deploy and orchestrate services to Azure Stack Hub.</span></span>

<span data-ttu-id="a559b-440">**Overwegingen**</span><span class="sxs-lookup"><span data-stu-id="a559b-440">**Considerations**</span></span>

<span data-ttu-id="a559b-441">Een van de belangrijkste verschillen wanneer het gaat om Azure Stack hub-implementaties is de vraag van Internet toegankelijkheid.</span><span class="sxs-lookup"><span data-stu-id="a559b-441">One of the major differences when it comes to Azure Stack Hub deployments is the question of Internet accessibility.</span></span> <span data-ttu-id="a559b-442">Internet toegankelijkheid bepaalt of een door micro soft of een zelf-hostende build-agent moet worden geselecteerd voor uw CI/CD-taken.</span><span class="sxs-lookup"><span data-stu-id="a559b-442">Internet accessibility determines whether to select a Microsoft-hosted or a self-hosted build agent for your CI/CD jobs.</span></span>

<span data-ttu-id="a559b-443">Een zelf-hostende agent kan worden uitgevoerd op Azure Stack hub (als een IaaS-VM) of in een subnet van een netwerk dat toegang heeft tot Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-443">A self-hosted agent can run on top of Azure Stack Hub (as an IaaS VM) or in a network subnet that can access Azure Stack Hub.</span></span> <span data-ttu-id="a559b-444">Ga naar [Azure pipelines-agents](/azure/devops/pipelines/agents/agents) voor meer informatie over de verschillen.</span><span class="sxs-lookup"><span data-stu-id="a559b-444">Go to [Azure Pipelines agents](/azure/devops/pipelines/agents/agents) to learn more about the differences.</span></span>

<span data-ttu-id="a559b-445">De volgende afbeelding helpt u om te bepalen of u een zelf-hostend of een door micro soft gehoste build-agent nodig hebt:</span><span class="sxs-lookup"><span data-stu-id="a559b-445">The following image helps you to decide if you need a self-hosted or a Microsoft-hosted build agent:</span></span>

![Zelf-hostende build-agents ja of Nee](media/pattern-highly-available-kubernetes/aks-on-stack-self-hosted-build-agents-yes-or-no.png)

- <span data-ttu-id="a559b-447">Zijn de Azure Stack hub-beheer eindpunten toegankelijk via Internet?</span><span class="sxs-lookup"><span data-stu-id="a559b-447">Are the Azure Stack Hub management endpoints accessible via Internet?</span></span>
  - <span data-ttu-id="a559b-448">Ja: we kunnen Azure-pijp lijnen gebruiken met door micro soft gehoste agents om verbinding te maken met Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-448">Yes: We can use Azure Pipelines with Microsoft-hosted agents to connect to Azure Stack Hub.</span></span>
  - <span data-ttu-id="a559b-449">Nee: er zijn zelf-hostende agents nodig die verbinding kunnen maken met de beheer eindpunten van Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-449">No: We need self-hosted agents that can connect to Azure Stack Hub's management endpoints.</span></span>
- <span data-ttu-id="a559b-450">Is het Kubernetes-cluster toegankelijk via Internet?</span><span class="sxs-lookup"><span data-stu-id="a559b-450">Is our Kubernetes cluster accessible via the Internet?</span></span>
  - <span data-ttu-id="a559b-451">Ja: we kunnen Azure-pijp lijnen gebruiken met door micro soft gehoste agents om rechtstreeks te communiceren met het Kubernetes API-eind punt.</span><span class="sxs-lookup"><span data-stu-id="a559b-451">Yes: We can use Azure Pipelines with Microsoft-hosted agents to interact directly with Kubernetes API endpoint.</span></span>
  - <span data-ttu-id="a559b-452">Nee: er zijn zelf-hostende agents nodig die verbinding kunnen maken met het Kubernetes-cluster-API-eind punt.</span><span class="sxs-lookup"><span data-stu-id="a559b-452">No: We need self-hosted Agents that can connect to the Kubernetes cluster API endpoint.</span></span>

<span data-ttu-id="a559b-453">In scenario's waarin de Azure Stack hub-beheer-eind punten en Kubernetes-API toegankelijk zijn via internet, kan de implementatie gebruikmaken van een door micro soft gehoste agent.</span><span class="sxs-lookup"><span data-stu-id="a559b-453">In scenarios where the Azure Stack Hub management endpoints and Kubernetes API are accessible via the internet, the deployment can use a Microsoft-hosted agent.</span></span> <span data-ttu-id="a559b-454">Deze implementatie resulteert in een toepassings architectuur als volgt:</span><span class="sxs-lookup"><span data-stu-id="a559b-454">This deployment will result in an application architecture as follows:</span></span>

<span data-ttu-id="a559b-455">[![Overzicht van open bare architectuur](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="a559b-455">[![Public architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span></span>

<span data-ttu-id="a559b-456">Als de Azure Resource Manager-eind punten, Kubernetes-API of beide niet rechtstreeks toegankelijk zijn via internet, kunnen we gebruikmaken van een zelf-hostende build-agent om de pijplijn stappen uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="a559b-456">If the Azure Resource Manager endpoints, Kubernetes API, or both aren't directly accessible via the Internet, we can leverage a self-hosted build agent to run the pipeline steps.</span></span> <span data-ttu-id="a559b-457">Dit ontwerp heeft minder connectiviteit nodig en kan worden geïmplementeerd met alleen on-premises netwerk connectiviteit met Azure Resource Manager-eind punten en de Kubernetes-API:</span><span class="sxs-lookup"><span data-stu-id="a559b-457">This design needs less connectivity, and can be deployed with only on-premises network connectivity to Azure Resource Manager endpoints and the Kubernetes API:</span></span>

<span data-ttu-id="a559b-458">[![Overzicht van on-premises architectuur](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="a559b-458">[![On-prem architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span></span>

> [!NOTE]
> <span data-ttu-id="a559b-459">**Hoe zit het met niet-verbonden scenario's?**</span><span class="sxs-lookup"><span data-stu-id="a559b-459">**What about disconnected scenarios?**</span></span> <span data-ttu-id="a559b-460">In scenario's waarin een Azure Stack hub of Kubernetes of beide niet over Internet gerichte beheer eindpunten beschikken, is het nog steeds mogelijk om Azure DevOps te gebruiken voor uw implementaties.</span><span class="sxs-lookup"><span data-stu-id="a559b-460">In scenarios where either Azure Stack Hub or Kubernetes or both of them do not have internet-facing management endpoints, it is still possible to use Azure DevOps for your deployments.</span></span> <span data-ttu-id="a559b-461">U kunt een zelf-hostende agent groep gebruiken (een DevOps-agent die on-premises of op Azure Stack hub zelf wordt uitgevoerd) of een volledig zelf-hostend Azure DevOps Server on-premises.</span><span class="sxs-lookup"><span data-stu-id="a559b-461">You can either use a self-hosted Agent Pool (which is a DevOps Agent running on-premises or on Azure Stack Hub itself) or a completly self-hosted Azure DevOps Server on-premises.</span></span> <span data-ttu-id="a559b-462">De zelf-hostende agent heeft alleen uitgaande HTTPS (TCP/443) Internet verbinding nodig.</span><span class="sxs-lookup"><span data-stu-id="a559b-462">The self-hosted agent needs only outbound HTTPS (TCP/443) Internet connectivity.</span></span>

<span data-ttu-id="a559b-463">Het patroon kan gebruikmaken van een Kubernetes-cluster (geïmplementeerd en gedistribueerd met AKS-Engine) op elk Azure Stack hub-exemplaar.</span><span class="sxs-lookup"><span data-stu-id="a559b-463">The pattern can use a Kubernetes cluster (deployed and orchestrated with AKS engine) on each Azure Stack Hub instance.</span></span> <span data-ttu-id="a559b-464">Het bevat een toepassing die bestaat uit een front-end, een mid-tier, backend-services (bijvoorbeeld MongoDB) en een op nginx gebaseerde ingangs controller.</span><span class="sxs-lookup"><span data-stu-id="a559b-464">It includes an application consisting of a frontend, a mid-tier, backend services (for example MongoDB), and an nginx-based Ingress Controller.</span></span> <span data-ttu-id="a559b-465">In plaats van een Data Base die wordt gehost op het K8s-cluster, kunt u gebruikmaken van "externe gegevens opslag".</span><span class="sxs-lookup"><span data-stu-id="a559b-465">Instead of using a database hosted on the K8s cluster, you can leverage "external data stores".</span></span> <span data-ttu-id="a559b-466">Database opties zijn onder andere MySQL, SQL Server, of een Data Base die buiten Azure Stack hub of in IaaS wordt gehost.</span><span class="sxs-lookup"><span data-stu-id="a559b-466">Database options include MySQL, SQL Server, or any kind of database hosted outside of Azure Stack Hub or in IaaS.</span></span> <span data-ttu-id="a559b-467">Configuraties zoals dit zijn niet in het bereik.</span><span class="sxs-lookup"><span data-stu-id="a559b-467">Configurations like this aren't in scope here.</span></span>

## <a name="partner-solutions"></a><span data-ttu-id="a559b-468">Partneroplossingen</span><span class="sxs-lookup"><span data-stu-id="a559b-468">Partner solutions</span></span>

<span data-ttu-id="a559b-469">Er zijn micro soft-partner oplossingen die de mogelijkheden van Azure Stack hub kunnen uitbreiden.</span><span class="sxs-lookup"><span data-stu-id="a559b-469">There are Microsoft Partner solutions that can extend the capabilities of Azure Stack Hub.</span></span> <span data-ttu-id="a559b-470">Deze oplossingen zijn handig voor implementaties van toepassingen die worden uitgevoerd op Kubernetes-clusters.</span><span class="sxs-lookup"><span data-stu-id="a559b-470">These solutions have been found useful in deployments of applications running on Kubernetes clusters.</span></span>  

## <a name="storage-and-data-solutions"></a><span data-ttu-id="a559b-471">Opslag-en gegevens oplossingen</span><span class="sxs-lookup"><span data-stu-id="a559b-471">Storage and data solutions</span></span>

<span data-ttu-id="a559b-472">Zoals beschreven in [overwegingen voor gegevens en opslag](#data-and-storage-considerations), heeft Azure stack hub momenteel geen systeem eigen oplossing om opslag over meerdere exemplaren te repliceren.</span><span class="sxs-lookup"><span data-stu-id="a559b-472">As described in [Data and storage considerations](#data-and-storage-considerations), Azure Stack Hub currently doesn't have a native solution to replicate storage across multiple instances.</span></span> <span data-ttu-id="a559b-473">In tegens telling tot Azure bestaat de mogelijkheid om opslag te repliceren over meerdere regio's niet.</span><span class="sxs-lookup"><span data-stu-id="a559b-473">Unlike Azure, the capability of replicating storage across multiple regions does not exist.</span></span> <span data-ttu-id="a559b-474">In Azure Stack hub is elk exemplaar een eigen afzonderlijke Cloud.</span><span class="sxs-lookup"><span data-stu-id="a559b-474">In Azure Stack Hub, each instance is its own distinct cloud.</span></span> <span data-ttu-id="a559b-475">Er zijn echter oplossingen beschikbaar van micro soft-partners die opslag replicatie mogelijk maken via Azure Stack hubs en Azure.</span><span class="sxs-lookup"><span data-stu-id="a559b-475">However, solutions are available from Microsoft Partners that enable storage replication across Azure Stack Hubs and Azure.</span></span> 

<span data-ttu-id="a559b-476">**Schaal baarheid**</span><span class="sxs-lookup"><span data-stu-id="a559b-476">**SCALITY**</span></span>

<span data-ttu-id="a559b-477">Met [schaal](https://www.scality.com/) levert de opslag op webschaal die is ingeschakeld voor digitale bedrijven sinds 2009.</span><span class="sxs-lookup"><span data-stu-id="a559b-477">[Scality](https://www.scality.com/) delivers web-scale storage that has powered digital businesses since 2009.</span></span> <span data-ttu-id="a559b-478">De schaal RING, onze door de software gedefinieerde opslag, maakt het mogelijk dat x86-servers met een grote beslag worden omgezet in een onbeperkte opslag groep voor elk type gegevens – bestand en object – op PETA byte schaal.</span><span class="sxs-lookup"><span data-stu-id="a559b-478">The Scality RING, our software-defined storage, turns commodity x86 servers into an unlimited storage pool for any type of data –file and object– at petabyte scale.</span></span>

<span data-ttu-id="a559b-479">**CLOUDIAN**</span><span class="sxs-lookup"><span data-stu-id="a559b-479">**CLOUDIAN**</span></span>

<span data-ttu-id="a559b-480">[Cloudian](https://www.cloudian.com/) vereenvoudigt bedrijfs opslag met onbeperkte schaal bare opslag waarmee enorme gegevens sets worden samengevoegd tot één eenvoudig beheerde omgeving.</span><span class="sxs-lookup"><span data-stu-id="a559b-480">[Cloudian](https://www.cloudian.com/) simplifies enterprise storage with limitless scalable storage that consolidates massive data sets to a single, easily managed environment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a559b-481">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="a559b-481">Next steps</span></span>

<span data-ttu-id="a559b-482">Voor meer informatie over de concepten die in dit artikel worden geïntroduceerd:</span><span class="sxs-lookup"><span data-stu-id="a559b-482">To learn more about concepts introduced in this article:</span></span>

- <span data-ttu-id="a559b-483">[Meerdere Cloud schalen](pattern-cross-cloud-scale.md) en patronen van [geografisch gedistribueerde apps](pattern-geo-distributed.md) in azure stack hub.</span><span class="sxs-lookup"><span data-stu-id="a559b-483">[Cross-cloud scaling](pattern-cross-cloud-scale.md) and [Geo-distributed app patterns](pattern-geo-distributed.md) in Azure Stack Hub.</span></span>
- <span data-ttu-id="a559b-484">[Architectuur van micro Services op Azure Kubernetes service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span><span class="sxs-lookup"><span data-stu-id="a559b-484">[Microservices architecture on Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span></span>

<span data-ttu-id="a559b-485">Wanneer u klaar bent om het voor beeld van de oplossing te testen, gaat u door met de [Kubernetes voor maximale Beschik baarheid van cluster implementatie](solution-deployment-guide-highly-available-kubernetes.md).</span><span class="sxs-lookup"><span data-stu-id="a559b-485">When you're ready to test the solution example, continue with the [High availability Kubernetes cluster deployment guide](solution-deployment-guide-highly-available-kubernetes.md).</span></span> <span data-ttu-id="a559b-486">De implementatie handleiding bevat stapsgewijze instructies voor het implementeren en testen van de onderdelen.</span><span class="sxs-lookup"><span data-stu-id="a559b-486">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>